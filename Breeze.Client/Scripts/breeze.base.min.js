(function(t){"object"==typeof exports?module.exports=t():"function"==typeof define?define(t):breeze=t()})(function(){function t(t,e){for(var n in t)U(t,n)&&e(n,t[n])}function e(t,e){for(var n in t)if(U(t,n)){var r=t[n];if(e(n,r))return{key:n,value:r}}return null}function n(t,e){var n=[];for(var r in t)if(U(t,r)){var i=e?e(r,t[r]):t[r];void 0!==i&&n.push(i)}return n}function r(t,e){return function(n){return n[t]===e}}function i(t){return function(e){return e[t]}}function a(t){var e=[];for(var n in t)U(t,n)&&e.push(t[n]);return e}function o(t,e){if(!e)return t;for(var n in e)U(e,n)&&(t[n]=e[n]);return t}function s(t,e){for(var n in e)void 0===t[n]&&(t[n]=e[n]);return t}function u(t,e){return e.defaultInstance=s(new e(t),e.defaultInstance),t}function p(t,e){var n={};for(var r in e)if(r in t){var i=t[r],a=e[r];i!=a&&(Array.isArray(i)&&0===i.length||("function"==typeof a?i=a(i):"object"==typeof i&&i&&i.parentEnum&&(i=i.name),void 0!==i&&(n[r]=i)))}return n}function c(t,e){var n={},r=t.length;return e.forEach(function(e){for(var i=0;r>i;i++){var a=t[i];if(a){var o=a[e];if(void 0!==o){n[e]=o;break}}}}),n}function y(t){return t?Array.isArray(t)?t:[t]:[]}function l(t,e){for(var n=0,r=t.length;r>n;n++)if(e(t[n]))return t[n];return null}function f(t,e){for(var n=0,r=t.length;r>n;n++)if(e(t[n]))return n;return-1}function h(t,e){for(var n=b(e)?e:void 0,r=t.length,i=0;r>i;i++)if(n?n(t[i]):t[i]===e)return t.splice(i,1),i;return-1}function d(t,e,n){for(var r=[],i=Math.min(t.length,e.length),a=0;i>a;++a)r.push(n(t[a],e[a]));return r}function m(t,e,n){if(!t||!e)return!1;if(t.length!==e.length)return!1;for(var r=0;t.length>r;r++)if(Array.isArray(t[r])){if(!m(t[r],e[r]))return!1}else if(n){if(!n(t[r],e[r]))return!1}else if(t[r]!==e[r])return!1;return!0}function v(t,e){var n=t[e];return n||(n=[],t[e]=n),n}function g(t,e){for(var n=t.split(";"),r=0,i=n.length;i>r;r++){var a=P(n[r]);if(a)return a}throw Error("Unable to initialize "+t+".  "+e||"")}function P(t){var e=window[t];return e?e:(window.require&&(e=window.require(t)),e?e:null)}function E(t,e,n,r){var i=t[e];if(n===i)return r();t[e]=n;try{return r()}finally{void 0===i?delete t[e]:t[e]=i}}function T(t,e,n){var r;try{return r=t(),n()}catch(i){throw"object"==typeof r&&(r.error=i),i}finally{e(r)}}function S(t){return function(){for(var e=G(arguments),n="",r=e.length,i=null;r--;)i=e[r],n+=i===Object(i)?JSON.stringify(i):i,t.memoize||(t.memoize={});return n in t.memoize?t.memoize[n]:t.memoize[n]=t.apply(this,e)}}function _(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=0|16*Math.random(),n="x"==t?e:8|3&e;return n.toString(16)})}function N(t){if("string"!=typeof t)throw Error("Invalid ISO8601 duration '"+t+"'");var e=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(t);if(!e)throw Error("Invalid ISO8601 duration '"+t+"'");for(var n=[2,3,4,6,7,8],r=[31104e3,2592e3,86400,3600,60,1],i=0,a=0;6>a;a++){var o=e[n[a]];o=o?+o.replace(/[A-Za-z]+/g,""):0,i+=o*r[a]}return i}function w(t){return null===t?"null":void 0===t?"undefined":Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function O(t){return"date"===w(t)&&!isNaN(t.getTime())}function b(t){return"function"===w(t)}function C(t){return"string"==typeof t&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(t)}function A(t){return"string"==typeof t&&/^(-|)?P([0-9]+Y|)?([0-9]+M|)?([0-9]+D|)?T?([0-9]+H|)?([0-9]+M|)?([0-9]+S|)?/.test(t)}function x(t){if(null===t||void 0===t)return!0;for(var e in t)if(U(t,e))return!1;return!0}function M(t){return!isNaN(parseFloat(t))&&isFinite(t)}function I(t,e){return t&&e?0===t.indexOf(e,0):!1}function k(t,e){return t&&e?-1!==t.indexOf(e,t.length-e.length):!1}function D(t){var e=arguments,n=RegExp("%([1-"+(arguments.length-1)+"])","g");return t.replace(n,function(t,n){return e[n]})}function F(t){var e=Function.call;return function(){return e.apply(t,arguments)}}function V(t,e,n){void 0===e&&(e=null);var r=n(),i=t.dataType;if(i&&i.parse&&(e=i.parse(e,typeof e)),!(e===r||i&&i.isDate&&e&&r&&e.valueOf()===r.valueOf())){var a,o,s=this,u=t.name,p=this.entityAspect;p?(o=p,a=u):(o=this.complexAspect,p=o.entityAspect,a=o.parent?o.propertyPath+"."+u:u);var c=p._inProcess;if(c){if(c.indexOf(t)>=0)return;c.push(t)}else c=[t],p._inProcess=c;var y=p.entity;try{var f=p.entityManager;if(p.entityState.isUnchangedOrModified()&&void 0===o.originalValues[u]&&t.isDataProperty&&!t.isComplexProperty&&(o.originalValues[u]=void 0!==r?r:t.defaultValue),t.isNavigationProperty){if(!t.isScalar)throw Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.");var h,d=t.inverse;if(e){if(f){if(e.entityAspect.entityState.isDetached())f.isLoading||f.attachEntity(e,se.Added);else if(e.entityAspect.entityManager!==f)throw Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.")}else e.entityAspect&&e.entityAspect.entityManager&&(f=e.entityAspect.entityManager,f.isLoading||f.attachEntity(p.entity,se.Added));if(d)if(d.isScalar)r&&r.setProperty(d.name,null),e.setProperty(d.name,this);else{if(r){h=r.getProperty(d.name);var m=h.indexOf(this);-1!==m&&h.splice(m,1)}var v=e.getProperty(d.name);v.push(this)}}else if(d)if(d.isScalar)r&&r.setProperty(d.name,null);else if(r){h=r.getProperty(d.name);var m=h.indexOf(this);-1!==m&&h.splice(m,1)}if(n(e),f&&!f.isLoading&&(p.entityState.isUnchanged()&&!t.isUnmapped&&p.setModified(),f.validationOptions.validateOnPropertyChange&&p._validateProperty(e,{entity:this,property:t,propertyName:a,oldValue:r})),t.relatedDataProperties&&!p.entityState.isDeleted()){var g=t.entityType.keyProperties;g.forEach(function(n,r){var i=t.relatedDataProperties[r];if(e||!i.isPartOfKey){var a=e?e.getProperty(n.name):i.defaultValue;s.setProperty(i.name,a)}})}}else if(t.isComplexProperty){if(!t.isScalar)throw Error(D("You cannot set a non-scalar complex property: '%1'",t.name));if(!e)throw Error(D("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",t.name,t.dataType.name));if(!r){var P=i.getCtor();r=new P,n(r)}i.dataProperties.forEach(function(t){var n=t.name,i=e.getProperty(n);r.setProperty(n,i)})}else{if(t.isPartOfKey&&!this.complexAspect&&f&&!f.isLoading){var E=this.entityType.keyProperties,T=E.map(function(n){return n==t?e:this.getProperty(n.name)},this),S=new oe(this.entityType,T);if(f.findEntityByKey(S))throw Error("An entity with this key is already in the cache: "+(""+S));var _=this.entityAspect.getKey(),N=f._findEntityGroup(this.entityType);N._replaceKey(_,S)}if(t.relatedNavigationProperty&&f){var w=t.relatedNavigationProperty;if(null!=e){var O=new oe(w.entityType,[e]),b=f.findEntityByKey(O);b?this.setProperty(w.name,b):f._unattachedChildrenMap.addChild(O,w,this)}else this.setProperty(w.name,null)}else if(t.invEntityType&&f&&!f._inKeyFixup){var C=t.invEntityType,A=l(C.navigationProperties,function(e){return e.invForeignKeyNames&&e.invForeignKeyNames.indexOf(t.name)>=0});if(null!=r&&!A.isScalar){var O=new oe(C,[r]),b=f.findEntityByKey(O);if(b){var x=b.getProperty(A.name);x.splice(x.indexOf(this),1)}}if(null!=e){var O=new oe(C,[e]),b=f.findEntityByKey(O);b?A.isScalar?b.setProperty(A.name,this):b.getProperty(A.name).push(this):f._unattachedChildrenMap.addChild(O,A,this)}}if(n(e),f&&!f.isLoading&&(p.entityState.isUnchanged()&&!t.isUnmapped&&p.setModified(),f.validationOptions.validateOnPropertyChange&&p._validateProperty(e,{entity:y,property:t,propertyName:a,oldValue:r})),t.isPartOfKey&&!this.complexAspect){r&&!p.entityState.isDetached()&&(p.primaryKeyWasChanged=!0);var M=this.entityType.keyProperties.indexOf(t);this.entityType.navigationProperties.forEach(function(t){var n=t.inverse;if(n){var r=n.foreignKeyNames;if(0===r.length)return;var i=s.getProperty(t.name),a=r[M];if(t.isScalar){if(!i)return;i.setProperty(a,e)}else i.forEach(function(t){t.setProperty(a,e)})}else{var r=t.invForeignKeyNames;if(0==r.length)return;var i=s.getProperty(t.name);if(!i)return;var a=r[M];t.isScalar?i.setProperty(a,e):i.forEach(function(t){t.setProperty(a,e)})}}),p.getKey(!0)}}var I={entity:y,property:t,propertyName:a,oldValue:r,newValue:e};f?f.isLoading||f.isRejectingChanges||(p.propertyChanged.publish(I),f.entityChanged.publish({entityAction:re.PropertyChange,entity:y,args:I})):p.propertyChanged.publish(I)}finally{c.pop()}}}function K(t){return t.indexOf(":#")>=0}function j(t,e){return t+":#"+e}function R(t,e,n){if(e)if(Array.isArray(e))e.forEach(t.addProperty);else{if("object"!=typeof e)throw Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property");for(var r in e)if(U(e,r)){var i=e[r];i.name=r;var a=new n(i);t.addProperty(a)}}}function L(t,e){var n;if(n=Array.isArray(e)?e:e.split("."),1===n.length)return t.getProperty(e);for(var r=t,i=0;n.length>i&&(r=r.getProperty(n[i]),null!=r);i++);return r}function q(t){return t&&t.isDate?function(t){return t&&t.getTime()}:t===ce.Time?function(t){return t&&N(t)}:function(t){return t}}var B={version:"1.3.4",metadataVersion:"1.0.4"};B.entityModel=B,B.entityTracking_backingStore="backingStore",B.entityTracking_ko="ko",B.entityTracking_backbone="backbone",B.remoteAccess_odata="odata",B.remoteAccess_webApi="webApi";var U=F(Object.prototype.hasOwnProperty),G=F(Array.prototype.slice);Object.create||(Object.create=function(t){var e=function(){};return e.prototype=t,new e});var Q={};Q.objectForEach=t,Q.extend=o,Q.propEq=r,Q.pluck=i,Q.arrayEquals=m,Q.arrayFirst=l,Q.arrayIndexOf=f,Q.arrayRemoveItem=h,Q.arrayZip=d,Q.requireLib=g,Q.using=E,Q.memoize=S,Q.getUuid=_,Q.durationToSeconds=N,Q.isDate=O,Q.isGuid=C,Q.isDuration=A,Q.isFunction=b,Q.isEmpty=x,Q.isNumeric=M,Q.stringStartsWith=I,Q.stringEndsWith=k,Q.formatString=D,Q.parent=B,B.core=Q;var $=function(){function t(t,e){return null==e?!1:"string"==typeof e&&e.length>0}function e(t,e){return null==e?!1:typeof e===t.typeName?!0:!1}function n(t,e){return null==e?!1:e instanceof t.type}function r(t,e){return null==e?!1:void 0!==e[t.propertyName]}function i(t,e){return null==e?!1:t.enumType.contains(e)}function a(t,e){return t.allowNull?void 0!==e:null!=e}function s(t,e){if(null==e)return!0;var n=t.prevContext;return n?n.fn(n,e):!0}function u(t,e){var n=t.prevContext,r=n?" or it "+y(n,e):"";return"is optional"+r}function p(t,e){if(!Array.isArray(e))return!1;if(t.mustNotBeEmpty&&0===e.length)return!1;var n=t.prevContext;return n?e.every(function(t){return n.fn(n,t)}):!0}function c(t,e){var n=t.mustNotBeEmpty?"a nonEmpty array":"an array",r=t.prevContext,i=r?" where each element "+y(r,e):"";return" must be "+n+i}function y(t,e){var n=t.msg;return"function"==typeof n&&(n=n(t,e)),n}function l(t,e){if(t._context){for(var n=t._context;null!=n.prevContext;)n=n.prevContext;if(null===n.prevContext)return n.prevContext=e,t;if(null!==e.prevContext)throw Error("Illegal construction - use 'or' to combine checks");e.prevContext=t._context}return f(t,e)}function f(t,e){return t._contexts[t._contexts.length-1]=e,t._context=e,t}function h(t){var e=t._contexts;return null==e[e.length-1]&&e.pop(),0===e.length?void 0:e.some(function(e){return e.fn(e,t.v)})}function d(t,e){throw Error(D("Error configuring an instance of '%1'. %2",t&&t._$typeName||"object",e))}var m=function(t,e){this.v=t,this.name=e,this._contexts=[null]},v=m.prototype;return v.isObject=function(){return this.isTypeOf("object")},v.isBoolean=function(){return this.isTypeOf("boolean")},v.isString=function(){return this.isTypeOf("string")},v.isNonEmptyString=function(){return l(this,{fn:t,msg:"must be a nonEmpty string"})},v.isNumber=function(){return this.isTypeOf("number")},v.isFunction=function(){return this.isTypeOf("function")},v.isTypeOf=function(t){return l(this,{fn:e,typeName:t,msg:D("must be a '%1'",t)})},v.isInstanceOf=function(t,e){return e=e||t.prototype._$typeName,l(this,{fn:n,type:t,typeName:e,msg:D("must be an instance of '%1'",e)})},v.hasProperty=function(t){return l(this,{fn:r,propertyName:t,msg:D("must have a '%1' property ",t)})},v.isEnumOf=function(t){return l(this,{fn:i,enumType:t,msg:D("must be an instance of the '%1' enumeration",t.name)})},v.isRequired=function(t){return l(this,{fn:a,allowNull:t,msg:"is required"})},v.isOptional=function(){var t={fn:s,prevContext:null,msg:u};return l(this,t)},v.isNonEmptyArray=function(){return this.isArray(!0)},v.isArray=function(t){var e={fn:p,mustNotBeEmpty:t,prevContext:null,msg:c};return l(this,e)},v.or=function(){return this._contexts.push(null),this._context=null,this},v.check=function(t){var e=h(this);if(void 0!==e){if(!e)throw Error(this.getMessage());return void 0!==this.v?this.v:t}},v._addContext=function(t){return l(this,t)},v.getMessage=function(){var t=this,e=this._contexts.map(function(e){return y(e,t.v)}).join(", or it ");return D(this.MESSAGE_PREFIX,this.name)+" "+e},v.withDefault=function(t){return this.defaultValue=t,this},v.whereParam=function(t){return this.parent.whereParam(t)},v.applyAll=function(t,e,n){var r=t._$typeName;n=n||r&&this.parent.config._$typeName===r;var i=o({},this.parent.config);if(this.parent.params.forEach(function(r){n||delete i[r.name];try{r.check()}catch(a){d(t,a.message)}!e&&r._applyOne(t)}),!n)for(var a in i)void 0!==i[a]&&d(t,D("Unknown property: '%1'.",a))},v._applyOne=function(t){void 0!==this.v?t[this.name]=this.v:void 0!==this.defaultValue&&(t[this.name]=this.defaultValue)},v.MESSAGE_PREFIX="The '%1' parameter ",m}(),z=function(t,e){return new $(t,e)},J=function(){var t=function(t){if("object"!=typeof t)throw Error("Configuration parameter should be an object, instead it is a: "+typeof t);this.config=t,this.params=[]},e=t.prototype;return e.whereParam=function(t){var e=new $(this.config[t],t);return e.parent=this,this.params.push(e),e},t}(),W=function(t){return new J(t)};Q.Param=$,Q.assertParam=z,Q.assertConfig=W;var X=function(){function t(){}var e=function(e,n){this.name=e;var r=new t(n);r.parentEnum=this,this._symbolPrototype=r,n&&Object.keys(n).forEach(function(t){r[t]=n[t]})},n=e.prototype;return e.isSymbol=function(e){return e instanceof t},n.fromName=function(t){return this[t]},n.addSymbol=function(t){var e=Object.create(this._symbolPrototype);return t&&Object.keys(t).forEach(function(n){e[n]=t[n]}),setTimeout(function(){e.getName()},0),e},n.seal=function(){this.getSymbols().forEach(function(t){return t.getName()})},n.getSymbols=function(){return this.getNames().map(function(t){return this[t]},this)},n.getNames=function(){var t=[];for(var e in this)this.hasOwnProperty(e)&&("name"==e||"_"===e.substr(0,1)||b(this[e])||t.push(e));return t},n.contains=function(e){return e instanceof t?this[e.getName()]===e:!1},t.prototype.getName=function(){if(!this.name){var t=this;this.name=l(this.parentEnum.getNames(),function(e){return t.parentEnum[e]===t})}return this.name},t.prototype.toString=function(){return this.getName()},t.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}},e}();Q.Enum=X;var H=function(){function t(t,e,r){var i=t._subscribers;return i?(i.forEach(function(i){try{i.callback(e)}catch(a){a.context="unable to publish on topic: "+t.name,r?r(a):t._defaultErrorCallback?t._defaultErrorCallback(a):n(a)}}),void 0):!0}function e(t){if(r[t])return t;var e=l(Object.keys(r),function(e){return 0===e.indexOf(t)});if(!e)throw Error("Unable to find any registered event that matches: "+t);return e}function n(){}var r={},i=function(t,e,n){z(t,"eventName").isNonEmptyString().check(),z(e,"publisher").isObject().check(),this.name=t,r[t]=!0,this.publisher=e,this._nextUnsubKey=1,n&&(this._defaultErrorCallback=n)},a=i.prototype;return a.publish=function(e,n,r){return i._isEnabled(this.name,this.publisher)?(n===!0?setTimeout(t,0,this,e,r):t(this,e,r),!0):!1},a.publishAsync=function(t,e){this.publish(t,!0,e)},a.subscribe=function(t){this._subscribers||(this._subscribers=[]);var e=this._nextUnsubKey;return this._subscribers.push({unsubKey:e,callback:t}),++this._nextUnsubKey,e},a.unsubscribe=function(t){if(!this._subscribers)return!1;var e=this._subscribers,n=f(e,function(e){return e.unsubKey===t});return-1!==n?(e.splice(n,1),0===e.length&&(this._subscribers=null),!0):!1},a.clear=function(){this._subscribers=null},i.bubbleEvent=function(t,e){t._getEventParent=e},i.enable=function(t,n,r){z(t,"eventName").isNonEmptyString().check(),z(n,"obj").isObject().check(),z(r,"isEnabled").isBoolean().isOptional().or().isFunction().check(),t=e(t),n._$eventMap||(n._$eventMap={}),n._$eventMap[t]=r},i._enableFast=function(t,e,n){e._$eventMap||(e._$eventMap={}),e._$eventMap[t.name]=n},i.isEnabled=function(t,n){if(z(t,"eventName").isNonEmptyString().check(),z(n,"obj").isObject().check(),!n._getEventParent)throw Error("This object does not support event enabling/disabling");return i._isEnabled(n,e(t))},i._isEnabled=function(t,e){var n=null,r=e._$eventMap;if(r&&(n=r[t]),null!=n)return"function"==typeof n?n(e):!!n;var a=e._getEventParent&&e._getEventParent();return a?i._isEnabled(t,a):!0},i}();Q.Event=H;var Y=function(){function t(t,e,n){var r=e.defaultInstance;return r||(r=new e.ctor,e.defaultInstance=r,r._$impl=e),r.initialize(),n&&(t.defaultInstance=r),i.interfaceInitialized.publish({interfaceName:t.name,instance:r,isDefault:!0}),r.checkForRecomposition&&i.interfaceInitialized.subscribe(function(t){r.checkForRecomposition(t)}),r}function r(t){var n=t.toLowerCase(),r=e(i.interfaceRegistry||{},function(t){return t.toLowerCase()===n});if(!r)throw Error("Unknown interface name: "+t);return r.value}var i={};i.functionRegistry={},i.typeRegistry={},i.objectRegistry={},i.interfaceInitialized=new H("interfaceInitialized_config",i);var a=function(t){this.name=t,this.defaultInstance=null,this._implMap={}};return a.prototype.registerCtor=function(t,e){this._implMap[t.toLowerCase()]={ctor:e,defaultInstance:null}},a.prototype.getImpl=function(t){return this._implMap[t.toLowerCase()]},a.prototype.getFirstImpl=function(){var t=e(this._implMap,function(){return!0});return t?t.value:null},i.interfaceRegistry={ajax:new a("ajax"),modelLibrary:new a("modelLibrary"),dataService:new a("dataService")},i.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance)throw Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.");return this.defaultInstance},i.setProperties=function(t){W(t).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(t),t.remoteAccessImplementation&&i.initializeAdapterInstance("dataService",t.remoteAccessImplementation),t.trackingImplementation&&i.initializeAdapterInstance("modelLibrary",t.trackingImplementation),t.ajaxImplementation&&i.initializeAdapterInstance("ajax",t.ajaxImplementation)},i.registerAdapter=function(t,e){z(t,"interfaceName").isNonEmptyString().check(),z(e,"adapterCtor").isFunction().check();var n=new e,i=n.name;if(!i)throw Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.");var a=r(t);a.registerCtor(i,e)},i.getAdapter=function(t,e){var n=r(t);if(e){var i=n.getImpl(e);return i?i.ctor:null}return n.defaultInstance?n.defaultInstance._$impl.ctor:null},i.initializeAdapterInstances=function(t){return W(t).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().applyAll(this,!1),n(t,i.initializeAdapterInstance)},i.initializeAdapterInstance=function(e,n,i){i=void 0===i?!0:i,z(e,"interfaceName").isNonEmptyString().check(),z(n,"adapterName").isNonEmptyString().check(),z(i,"isDefault").isBoolean().check();var a=r(e),o=a.getImpl(n);if(!o)throw Error("Unregistered adapter.  Interface: "+e+" AdapterName: "+n);return t(a,o,i)},i.getAdapterInstance=function(e,n){var i,a=r(e);return n&&""!==n?(i=a.getImpl(n),i?i.defaultInstance:null):a.defaultInstance?a.defaultInstance:(i=a.getFirstImpl(),i.defaultInstance?i.defaultInstance:t(a,i,!0))},i.registerFunction=function(t,e){z(t,"fn").isFunction().check(),z(e,"fnName").isString().check(),t.prototype._$fnName=e,i.functionRegistry[e]=t},i._storeObject=function(t,e,n){var r=("string"==typeof e?e:e.prototype._$typeName)+"."+n;i.objectRegistry[r]=t},i._fetchObject=function(t,e){if(!e)return void 0;var n=("string"==typeof t?t:t.prototype._$typeName)+"."+e,r=i.objectRegistry[n];if(!r)throw Error("Unable to locate a registered object by the name: "+n);return r},i.registerType=function(t,e){z(t,"ctor").isFunction().check(),z(e,"typeName").isString().check(),t.prototype._$typeName=e,i.typeRegistry[e]=t},i.stringifyPad="  ",i}(),Z=Y.interfaceRegistry.modelLibrary;Q.config=Y,B.config=Y;var te=function(){function e(t,e,n){return e?t.replace(/%([^%]+)%/g,function(t,r){var i;return i=n?e.hasOwnProperty(r)?e[r]:"":e[r],i?b(i)?i(e):i:""}):t}function n(t,e,n,r){return y.messageTemplates[t]=D("'%displayName%' must be an integer between the values of %1 and %2",e,n),function(){var i=function(t,r){return null==t?!0:("string"==typeof t&&r&&r.allowString&&(t=parseInt(t,0)),"number"!=typeof t||isNaN(t)||Math.floor(t)!==t?!1:null!=e&&e>t?!1:null!=n&&t>n?!1:!0)};return new y(t,i,r)}}var r=-32768,i=32767,a=-2147483648,s=2147483647,u=0,p=255,c={displayName:function(t){return t.property?t.property.displayName||t.propertyName||t.property.name:"Value"}},y=function(t,e,n){this._baseContext=n||{},this._baseContext.name=t,n=o(Object.create(c),this._baseContext),n.messageTemplate=n.messageTemplate||y.messageTemplates[t],this.name=t,this.valFn=e,this.context=n},l=y.prototype;return l._$typeName="Validator",l.validate=function(t,e){var n;return n=e?o(Object.create(this.context),e):this.context,this.currentContext=n,this.valFn(t,n)?null:(n.value=t,new ee(this,n,this.getMessage()))},l.getMessage=function(){try{var t=this.currentContext,n=t.message;return n?"function"==typeof n?n(t):n:t.messageTemplate?e(t.messageTemplate,t):"invalid value: "+this.name||"{unnamed validator}"}catch(r){return"Unable to format error message"+(""+r)}},l.toJSON=function(){return this._baseContext},y.fromJSON=function(t){var e="Validator."+t.name,n=Y.functionRegistry[e];if(!n)throw Error("Unable to locate a validator named:"+t.name);return n(t)},y.register=function(t){Y.registerFunction(function(){return t},"Validator."+t.name)},y.registerFactory=function(t,e){Y.registerFunction(t,"Validator."+e)},y.messageTemplates={required:"'%displayName%' is required",date:"'%displayName%' must be a date",string:"'%displayName%' must be a string",bool:"'%displayName%' must be a 'true' or 'false' value",guid:"'%displayName%' must be a GUID",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",number:"'%displayName%' must be a number",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with less than %maxLength% characters",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters"},y.required=function(){var t=function(t,e){return"string"==typeof t?e&&e.allowEmptyStrings?!0:t.length>0:null!=t};return new y("required",t)},y.maxLength=function(t){var e=function(t,e){return null==t?!0:"string"!=typeof t?!1:t.length<=e.maxLength};return new y("maxLength",e,t)},y.stringLength=function(t){var e=function(t,e){return null==t?!0:"string"!=typeof t?!1:null!=e.minLength&&t.length<e.minLength?!1:null!=e.maxLength&&t.length>e.maxLength?!1:!0};return new y("stringLength",e,t)},y.string=function(){var t=function(t){return null==t?!0:"string"==typeof t};return new y("string",t)},y.guid=function(){var t=function(t){return null==t?!0:C(t)};return new y("guid",t)},y.duration=function(){var t=function(t){return null==t?!0:A(t)};return new y("duration",t)},y.number=y.double=y.single=function(t){var e=function(t,e){return null==t?!0:("string"==typeof t&&e&&e.allowString&&(t=parseInt(t,10)),"number"==typeof t&&!isNaN(t))};return new y("number",e,t)},y.integer=y.int64=function(t){var e=function(t,e){return null==t?!0:("string"==typeof t&&e&&e.allowString&&(t=parseInt(t,10)),"number"==typeof t&&!isNaN(t)&&Math.floor(t)===t)};return new y("integer",e,t)},y.int32=function(t){return n("int32",a,s,t)()},y.int16=function(t){return n("int16",r,i,t)()},y.byte=function(t){return n("byte",u,p,t)()},y.bool=function(){var t=function(t){return null==t?!0:t===!0||t===!1};return new y("bool",t)},y.none=function(){var t=function(){return!0};return new y("none",t)},y.date=function(){var t=function(t){if(null==t)return!0;if("string"!=typeof t)return O(t);try{return!isNaN(Date.parse(t))}catch(e){return!1}};return new y("date",t)},t(y,function(t,e){"function"==typeof e&&"fromJSON"!==t&&"register"!==t&&"registerFactory"!==t&&Y.registerFunction(e,"Validator."+t)}),y}(),ee=function(){var t=function(t,e,n){z(t,"validator").isString().or().isInstanceOf(te).check(),this.validator=t,e=e||{},this.context=e,this.property=e.property,this.property&&(this.propertyName=e.propertyName||e.property.name),this.errorMessage=n,this.key=ee.getKey(t,this.propertyName)};return t.getKey=function(t,e){return(e||"")+":"+t.name},t}();B.Validator=te,B.ValidationError=ee;var ne=function(){function t(t,e){return e&&W(e).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(t),t}var e=function(e){t(this,e)},n=e.prototype;return n._$typeName="ValidationOptions",n.using=function(e){if(!e)return this;var n=new ne(this);return t(n,e),n},n.setAsDefault=function(){return u(this,e)},e.defaultInstance=new e({validateOnAttach:!0,validateOnSave:!0,validateOnQuery:!1,validateOnPropertyChange:!0}),e}();B.ValidationOptions=ne,B.makeComplexArray=function(){function t(t,n){var r=e(t,n);return r.length?r:r}function e(t,e){return e}function n(t,e){i(t,"arrayChanged",{complexArray:t,added:e})}function r(t,e){i(t,"arrayChanged",{complexArray:t,removed:e})}function i(t,e,n){var r=t._getPendingPubs();r?t._pendingArgs?a(t._pendingArgs,n):(t._pendingArgs=n,r.push(function(){t[e].publish(t._pendingArgs),t._pendingArgs=null})):t[e].publish(n)}function a(t,e){for(var n in e)if("complexArray"!==n&&t.hasOwnProperty(n)){var r=e[n],i=t[n];if(i){if(!Array.isArray(i))throw Error("Cannot combine non array args");Array.prototype.push.apply(i,r)}else t[n]=r}}function s(t,e,n){return t.parentEntity=e,t.complexProperty=n,t.arrayChanged=new H("arrayChanged_entityCollection",t),t._addsInProcess=[],o(t,u)}var u={};return u.push=function(){if(this._inProgress)return-1;var e=t(this,G(arguments));if(!e.length)return this.length;var r=Array.prototype.push.apply(this,e);return n(this,e),r},u.unshift=function(){var e=t(this,G(arguments));if(!e.length)return this.length;var r=Array.prototype.unshift.apply(this,e);return n(this,G(e)),r},u.pop=function(){var t=Array.prototype.pop.apply(this);return r(this,[t]),t},u.shift=function(){var t=Array.prototype.shift.apply(this);return r(this,[t]),t},u.splice=function(){var e=t(this,G(arguments,2)),i=G(arguments,0,2).concat(e),a=Array.prototype.splice.apply(this,i);return r(this,a),e.length&&n(this,e),a},u._getEventParent=function(){return this.parentEntity.entityAspect},u._getPendingPubs=function(){var t=this.parentEntity.entityAspect.entityManager;return t&&t._pendingPubs},s}();var re=function(){var t={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}},e=new X("EntityAction",t);return e.Attach=e.addSymbol({isAttach:!0}),e.AttachOnQuery=e.addSymbol({isAttach:!0}),e.AttachOnImport=e.addSymbol({isAttach:!0}),e.Detach=e.addSymbol({isDetach:!0}),e.MergeOnQuery=e.addSymbol({isModification:!0}),e.MergeOnImport=e.addSymbol({isModification:!0}),e.MergeOnSave=e.addSymbol({isModification:!0}),e.PropertyChange=e.addSymbol({isModification:!0}),e.EntityStateChange=e.addSymbol(),e.AcceptChanges=e.addSymbol(),e.RejectChanges=e.addSymbol({isModification:!0}),e.Clear=e.addSymbol({isDetach:!0}),e.seal(),e}();B.EntityAction=re;var ie=function(){function e(t){var n=t.entityAspect||t.complexAspect,r=t.entityType||t.complexType,i=n.originalValues;for(var a in i)t.setProperty(a,i[a]);r.complexProperties.forEach(function(n){var r=t.getProperty(n.name);n.isScalar?e(r):r.forEach(function(t){e(t)})})}function n(t){var e=t.entityAspect||t.complexAspect;e.originalValues={};var r=t.entityType||t.complexType;r.complexProperties.forEach(function(e){var r=t.getProperty(e.name);e.isScalar?n(r):r.forEach(function(t){n(t)})})}function r(t){var e=!0,n=t.entityType||t.complexType,a=t.entityAspect||t.complexAspect,o=t.entityAspect||t.complexAspect.entityAspect;return n.getProperties().forEach(function(n){var i=t.getProperty(n.name),s=a.propertyPath?a.propertyPath+"."+n.name:n.name;if(n.validators.length>0){var u={entity:o.entity,property:n,propertyName:s};e=o._validateProperty(i,u)&&e}n.isComplexProperty&&n.isScalar&&(e=r(i)&&e)}),n.validators.forEach(function(t){e=i(o,t,a.entity)&&e}),e}function i(t,e,n,r){var i=e.validate(n,r);return i?(t._addValidationError(i),!1):(t._removeValidationError(e,r?r.propertyName:null),!0)}var o=function(t){if(null===t){var e=ie._nullInstance;if(e)return e;ie._nullInstance=this}else{if(void 0===t)throw Error("The EntityAspect ctor requires an entity as its only argument.");if(t.entityAspect)return t.entityAspect}if(!(this instanceof ie))return new ie(t);if(this.entity=t,this.entityGroup=null,this.entityManager=null,this.entityState=se.Detached,this.isBeingSaved=!1,this.originalValues={},this._validationErrors={},this.validationErrorsChanged=new H("validationErrorsChanged_entityAspect",this),this.propertyChanged=new H("propertyChanged_entityAspect",this),null!=t){t.entityAspect=this;var n=t.entityType;if(!n){var r=t.prototype._$typeName;throw r?Error("Metadata for this entityType has not yet been resolved: "+r):Error("This entity is not registered as a valid EntityType")}var i=n.getEntityCtor();Z.getDefaultInstance().startTracking(t,i.prototype)}},s=o.prototype;return s._postInitialize=function(){var t=this.entity,e=t.entityType.getEntityCtor(),n=e._$initializationFn;n&&("string"==typeof n&&(n=t[n]),n(t))},H.bubbleEvent(s,function(){return this.entityManager}),s.getKey=function(t){if(t=z(t,"forceRefresh").isBoolean().isOptional().check(!1),t||!this._entityKey){var e=this.entity.entityType,n=e.keyProperties,r=n.map(function(t){return this.entity.getProperty(t.name)},this);this._entityKey=new oe(e,r)}return this._entityKey},s.acceptChanges=function(){var t=this.entityManager;this.entityState.isDeleted()?t.detachEntity(this.entity):this.setUnchanged(),t.entityChanged.publish({entityAction:re.AcceptChanges,entity:this.entity})},s.rejectChanges=function(){var t=this.entity,n=this.entityManager;E(n,"isRejectingChanges",!0,function(){e(t)}),this.entityState.isAdded()?(n.detachEntity(t),n._notifyStateChange(t,!1)):(this.entityState.isDeleted()&&this.entityManager._linkRelatedEntities(t),this.setUnchanged(),this.propertyChanged.publish({entity:t,propertyName:null}),this.entityManager.entityChanged.publish({entityAction:re.RejectChanges,entity:t}))},s.setUnchanged=function(){n(this.entity),delete this.hasTempKey,this.entityState=se.Unchanged,this.entityManager._notifyStateChange(this.entity,!1)},s.setModified=function(){this.entityState=se.Modified,this.entityManager._notifyStateChange(this.entity,!0)},s.setDeleted=function(){var t=this.entityManager;this.entityState.isAdded()?(t.detachEntity(this.entity),t._notifyStateChange(this.entity,!1)):(this.entityState=se.Deleted,this._removeFromRelations(),t._notifyStateChange(this.entity,!0))},s.loadNavigationProperty=function(t,e,n){var r=this.entity,i=r.entityType._checkNavProperty(t),a=Se.fromEntityNavigation(r,i,e,n);
return r.entityAspect.entityManager.executeQuery(a,e,n)},s.validateEntity=function(){var t=!0;return this._processValidationOpAndPublish(function(e){t=r(e.entity)}),t},s.validateProperty=function(t,e){var n=this.getPropertyValue(t);return n&&n.complexAspect?r(n):(e=e||{},e.entity=this.entity,"string"==typeof t?(e.property=this.entity.entityType.getProperty(t,!0),e.propertyName=t):(e.property=t,e.propertyName=t.name),this._validateProperty(n,e))},s.getValidationErrors=function(t){z(t,"property").isOptional().isEntityProperty().or().isString().check();var e=a(this._validationErrors);if(t){var n="string"==typeof t?t:t.name;e=e.filter(function(t){return t.property.name===n})}return e},s.addValidationError=function(t){z(t,"validationError").isInstanceOf(ee).check(),this._processValidationOpAndPublish(function(e){e._addValidationError(t)})},s.removeValidationError=function(t,e){z(t,"validator").isString().or().isInstanceOf(te).check(),z(e,"property").isOptional().isEntityProperty().check(),this._processValidationOpAndPublish(function(n){n._removeValidationError(t,e&&e.name)})},s.clearValidationErrors=function(){this._processValidationOpAndPublish(function(e){t(e._validationErrors,function(t,n){n&&(delete e._validationErrors[t],e._pendingValidationResult.removed.push(n))})})},s.getParentKey=function(t){var e=t.foreignKeyNames;if(0===e.length)return null;var n=this,r=e.map(function(t){return n.entity.getProperty(t)});return new oe(t.entityType,r)},s.getPropertyValue=function(t){z(t,"property").isString().or().isEntityProperty().check();var e;if("string"==typeof t){var n=t.trim().split("."),r=n.shift();for(e=this.entity,e=e.getProperty(r);n.length>0;)r=n.shift(),e=e.getProperty(r)}else{if(!(t.parentType instanceof he))throw Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; Pass a 'property path' string as the 'property' paramter instead ");e=this.entity.getProperty(t.name)}return e},s._detach=function(){this.entityGroup=null,this.entityManager=null,this.entityState=se.Detached,this.originalValues={},this._validationErrors={},this.validationErrorsChanged.clear(),this.propertyChanged.clear()},s._removeFromRelations=function(){var t=this.entity;t.entityType.navigationProperties.forEach(function(e){var n=e.inverse;if(n){var r=t.getProperty(e.name);if(e.isScalar){if(r){if(n.isScalar)r.setProperty(n.name,null);else{var i=r.getProperty(n.name);i.length&&h(i,t)}t.setProperty(e.name,null)}}else r.slice(0).forEach(function(t){n.isScalar&&t.setProperty(n.name,null)}),r.length=0}})},s._validateProperty=function(t,e){var n=!0;return this._processValidationOpAndPublish(function(r){e.property.validators.forEach(function(a){n=n&&i(r,a,t,e)})}),n},s._processValidationOpAndPublish=function(t){if(this._pendingValidationResult)t(this);else try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]},t(this),(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0)&&this.validationErrorsChanged.publish(this._pendingValidationResult)}finally{this._pendingValidationResult=void 0}},s._addValidationError=function(t){this._validationErrors[t.key]=t,this._pendingValidationResult.added.push(t)},s._removeValidationError=function(t,e){var n=ee.getKey(t,e),r=this._validationErrors[n];r&&(delete this._validationErrors[n],this._pendingValidationResult.removed.push(r))},o}(),ae=function(){var t=function(t,e,n){if(!t)throw Error("The  ComplexAspect ctor requires an entity as its only argument.");if(t.complexAspect)return t.complexAspect;if(!(this instanceof ae))return new ae(t,e,n);if(this.complexObject=t,t.complexAspect=this,this.originalValues={},null==e)this.entityAspect=new ie(null);else{this.parent=e,this.parentProperty=n,this.propertyPath=n;for(var r=e;r.complexType;)this.propertyPath=r.complexAspect.propertyPath+"."+this.propertyPath,r=r.complexAspect.parent;this.entityAspect=r.entityAspect}var i=t.complexType;if(!i){var a=t.prototype._$typeName;throw a?Error("Metadata for this complexType has not yet been resolved: "+a):Error("This entity is not registered as a valid ComplexType")}var o=i.getCtor();Z.getDefaultInstance().startTracking(t,o.prototype)},e=t.prototype;return e._postInitialize=function(){var t=this.complexObject,e=t.complexType.getCtor(),n=e._$initializationFn;n&&("string"==typeof n?t[n](t):e._$initializationFn(t))},t}();B.EntityAspect=ie,B.ComplexAspect=ae;var oe=function(){function t(t){return t.join(e)}var e=":::",n=function(e,n){z(e,"entityType").isInstanceOf(he).check();var r=e.getSelfAndSubtypes();r.length>1&&(this._subtypes=r.filter(function(t){return t.isAbstract===!1})),Array.isArray(n)||(n=G(arguments,1)),this.entityType=e,e.keyProperties.forEach(function(t,e){t.dataType===ce.Guid&&(n[e]=n[e]&&n[e].toLowerCase())}),this.values=n,this._keyInGroup=t(n)};n._$typeName="EntityKey";var r=n.prototype;return r.toJSON=function(){return{entityType:this.entityType.name,values:this.values}},n.fromJSON=function(t,e){var n=e._getEntityType(t.entityType,!0);return new oe(n,t.values)},r.equals=function(t){return t instanceof oe?this.entityType===t.entityType&&m(this.values,t.values):!1},r.toString=function(){return this.entityType.name+"-"+this._keyInGroup},n.equals=function(t,e){return t instanceof oe?t.equals(e):!1},r._isEmpty=function(){return 0===this.values.join("").length},n}();B.EntityKey=oe;var se=function(){var t={isUnchanged:function(){return this===e.Unchanged},isAdded:function(){return this===e.Added},isModified:function(){return this===e.Modified},isDeleted:function(){return this===e.Deleted},isDetached:function(){return this===e.Detached},isUnchangedOrModified:function(){return this===e.Unchanged||this===e.Modified},isAddedModifiedOrDeleted:function(){return this===e.Added||this===e.Modified||this===e.Deleted}},e=new X("EntityState",t);return e.Unchanged=e.addSymbol(),e.Added=e.addSymbol(),e.Modified=e.addSymbol(),e.Deleted=e.addSymbol(),e.Detached=e.addSymbol(),e.seal(),e}();B.EntityState=se,B.makeRelationArray=function(){function t(t,n){var r=e(t,n);if(!r.length)return r;var i=t.parentEntity,a=i.entityAspect.entityManager;return a&&!a.isLoading&&r.forEach(function(e){if(e.entityAspect.entityState.isDetached()){t._inProgress=!0;try{a.attachEntity(e,se.Added)}finally{t._inProgress=!1}}}),r}function e(t,e){var n=t.parentEntity,r=t.navigationProperty,i=r.inverse;if(i)var a=e.filter(function(e){if(t._addsInProcess.indexOf(e)>=0)return!1;var r=e.getProperty(i.name);return r!==n});else var o=r.invForeignKeyNames,s=n.entityType.keyProperties,a=e.filter(function(e){return t._addsInProcess.indexOf(e)>=0?!1:o.some(function(t,r){var i=s[r].name,a=n.getProperty(i),o=e.getProperty(t);return a!==o})});return a}function n(t,e){var n=t.parentEntity,i=t.navigationProperty,a=i.inverse,o=t._addsInProcess,s=o.length;try{e.forEach(function(t){if(o.push(t),a)t.setProperty(a.name,n);else{var e=n.entityType.keyProperties;i.invForeignKeyNames.forEach(function(r,i){t.setProperty(r,n.getProperty(e[i].name))})}})}finally{o.splice(s,e.length)}r(t,"arrayChanged",{relationArray:t,added:e})}function r(t,e,n){var r=t._getPendingPubs();r?t._pendingArgs?i(t._pendingArgs,n):(t._pendingArgs=n,r.push(function(){t[e].publish(t._pendingArgs),t._pendingArgs=null})):t[e].publish(n)}function i(t,e){for(var n in e)if("relationArray"!==n&&t.hasOwnProperty(n)){var r=e[n],i=t[n];if(i){if(!Array.isArray(i))throw Error("Cannot combine non array args");Array.prototype.push.apply(i,r)}else t[n]=r}}function a(t,e){var n=t.navigationProperty.inverse;n&&e.forEach(function(t){t.setProperty(n.name,null)}),r(t,"arrayChanged",{relationArray:t,removed:e})}function s(t,e,n){return t.parentEntity=e,t.navigationProperty=n,t.arrayChanged=new H("arrayChanged_entityCollection",t),t._addsInProcess=[],o(t,u)}var u={};return u.push=function(){if(this._inProgress)return-1;var e=t(this,G(arguments));if(!e.length)return this.length;var r=Array.prototype.push.apply(this,e);return n(this,e),r},u._push=function(){if(this._inProgress)return-1;var t=G(arguments),e=Array.prototype.push.apply(this,t);return n(this,t),e},u.unshift=function(){var e=t(this,G(arguments));if(!e.length)return this.length;var r=Array.prototype.unshift.apply(this,e);return n(this,G(e)),r},u.pop=function(){var t=Array.prototype.pop.apply(this);return a(this,[t]),t},u.shift=function(){var t=Array.prototype.shift.apply(this);return a(this,[t]),t},u.splice=function(){var e=t(this,G(arguments,2)),r=G(arguments,0,2).concat(e),i=Array.prototype.splice.apply(this,r);return a(this,i),e.length&&n(this,e),i},u.load=function(t,e){var n=this.parentEntity,r=Se.fromEntityNavigation(this.parentEntity,this.navigationProperty),i=n.entityAspect.entityManager;return i.executeQuery(r,t,e)},u._getEventParent=function(){return this.parentEntity.entityAspect},u._getPendingPubs=function(){var t=this.parentEntity.entityAspect.entityManager;return t&&t._pendingPubs},s}();var ue=function(){function t(t,e){return e&&(W(e).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(pe).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(t),t.serviceName=t.serviceName&&ue._normalizeServiceName(t.serviceName),t.adapterInstance=t.adapterName&&Y.getAdapterInstance("dataService",t.adapterName)),t}var e=function(e){t(this,e)},n=e.prototype;return n._$typeName="DataService",n.using=function(e){if(!e)return this;var n=new ue(this);return t(n,e)},e.resolve=function(t){t.push({hasServerMetadata:!0,useJsonp:!1});var e=new ue(c(t,["serviceName","adapterName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!e.serviceName)throw Error("Unable to resolve a 'serviceName' for this dataService");return e.adapterInstance=e.adapterInstance||Y.getAdapterInstance("dataService",e.adapterName),e.jsonResultsAdapter=e.jsonResultsAdapter||e.adapterInstance.jsonResultsAdapter,e},e._normalizeServiceName=function(t){return t=t.trim(),"/"!==t.substr(-1)?t+"/":t},n.toJSON=function(){return p(this,{serviceName:null,adapterName:null,hasServerMetadata:null,jsonResultsAdapter:function(t){return t&&t.name},useJsonp:null})},e.fromJSON=function(t){return t.jsonResultsAdapter=Y._fetchObject(pe,t.jsonResultsAdapter),new ue(t)},n.makeUrl=function(t){var e=this.serviceName;return Q.stringEndsWith(e,"/")&&(e=e.substr(0,e.length-1)),t="/"+t,Q.stringEndsWith(e,t)||(e+=t),e},e}(),pe=function(){function t(t){return t.results}var e=function(e){if(1!=arguments.length)throw Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.");W(e).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(t).whereParam("visitNode").isFunction().applyAll(this),Y._storeObject(this,n._$typeName,this.name)},n=e.prototype;return n._$typeName="JsonResultsAdapter",e}();B.DataService=ue,B.JsonResultsAdapter=pe;var ce=function(){function t(t,e){throw t=D(t,e),Error(t)}function e(t){switch(t){case N.String:return te.string;case N.Int64:return te.int64;case N.Int32:return te.int32;case N.Int16:return te.int16;case N.Decimal:return te.number;case N.Double:return te.number;case N.Single:return te.number;case N.DateTime:return te.date;case N.DateTimeOffset:return te.date;case N.Boolean:return te.bool;case N.Guid:return te.guid;case N.Byte:return te.byte;case N.Binary:return te.none;case N.Time:return te.duration;case N.Undefined:return te.none}}var n={},r={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1},i=function(){return r.stringPrefix+(""+a())},a=function(){var t=r.nextNumber;return r.nextNumber+=r.nextNumberIncrement,t},o=function(){return _()},s=function(){return new Date},u=function(t){return null==t?t:""+t},p=function(t,e){if("string"===e){var n=t.trim();if(""===n)return null;var r=parseInt(n,10);return isNaN(r)?t:r}return"number"===e?Math.round(t):t},c=function(t,e){if("string"===e){var n=t.trim();if(""===n)return null;var r=parseFloat(n);return isNaN(r)?t:r}return t},y=function(t,e){if("string"===e){var n=t.trim();if(""===n)return null;var r=new Date(Date.parse(n));return O(r)?r:t}if("number"===e){var r=new Date(t);return O(r)?r:t}return t},l=function(t,e){if("string"===e){var n=t.trim().toLowerCase();return"false"===n||""===n?!1:"true"===n?!0:t}return t},f=function(t){return null==t?null:"'"+t+"'"},h=function(t){return null==t?null:"string"==typeof t?parseInt(t):t},d=function(t){return function(e){return null==e?null:("string"==typeof e&&(e=parseFloat(e)),e+t)}},m=function(e){if(null==e)return null;try{return"datetime'"+e.toISOString()+"'"}catch(n){t("'%1' is not a valid dateTime",e)}},v=function(e){if(null==e)return null;try{return"datetimeoffset'"+e.toISOString()+"'"}catch(n){t("'%1' is not a valid dateTime",e)}},g=function(e){return null==e?null:(A(e)||t("'%1' is not a valid ISO 8601 duration",e),"time'"+e+"'")},P=function(e){return null==e?null:(C(e)||t("'%1' is not a valid guid",e),"guid'"+e+"'")},E=function(t){return null==t?null:"string"==typeof t?"true"===t.trim().toLowerCase():!!t},T=function(t){return null==t?t:"binary'"+t+"'"},S=function(t){return t},N=new X("DataType",n);N.String=N.addSymbol({defaultValue:"",parse:u,fmtOData:f,getNext:i}),N.Int64=N.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,quoteJsonOData:!0,parse:p,fmtOData:h,getNext:a}),N.Int32=N.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:p,fmtOData:h,getNext:a}),N.Int16=N.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:p,fmtOData:h,getNext:a}),N.Byte=N.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:p,fmtOData:h}),N.Decimal=N.addSymbol({defaultValue:0,isNumeric:!0,quoteJsonOData:!0,parse:c,fmtOData:d("m"),getNext:a}),N.Double=N.addSymbol({defaultValue:0,isNumeric:!0,parse:c,fmtOData:d("d"),getNext:a}),N.Single=N.addSymbol({defaultValue:0,isNumeric:!0,parse:c,fmtOData:d("f"),getNext:a}),N.DateTime=N.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:y,fmtOData:m,getNext:s}),N.DateTimeOffset=N.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:y,fmtOData:v,getNext:s}),N.Time=N.addSymbol({defaultValue:"PT0S",fmtOData:g}),N.Boolean=N.addSymbol({defaultValue:!1,parse:l,fmtOData:E}),N.Guid=N.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",fmtOData:P,getNext:o}),N.Binary=N.addSymbol({defaultValue:null,fmtOData:T}),N.Undefined=N.addSymbol({defaultValue:void 0,fmtOData:S}),N.seal(),N.fromEdmDataType=function(t){var e=null,n=t.split(".");if(n.length>1){var r=n[1];e="image"===r?N.Byte:2==n.length?N.fromName(r)||N.Undefined:N.String}return e},N.fromValue=function(t){if(O(t))return N.DateTime;switch(typeof t){case"string":return C(t)?N.Guid:A(t)&&t.length>3?N.Time:N.String;case"boolean":return N.Boolean;case"number":return N.Int32}return N.Undefined};var w=/.\d{3}$/;return N.parseDateAsUTC=function(t){if("string"==typeof t){var e=w.test(t);t=e?t+"Z":t}return t=new Date(Date.parse(t))},N.parseDateFromServer=N.parseDateAsUTC,N.constants=r,N.getSymbols().forEach(function(t){t.validatorCtor=e(t)}),N}();B.DataType=ce;var ye=g("Q","See https://github.com/kriskowal/q "),le=function(){function t(t){var e=[];for(var n in t){var r=t[n];n===r.name&&e.push(t[n])}return e}function e(t,e){var n=j(e.shortName,e.namespace),i=t._getEntityType(n,!0);if(i)return i;var a={shortName:e.shortName,namespace:e.namespace,isAbstract:e.isAbstract,autoGeneratedKeyType:ge.fromName(e.autoGeneratedKeyType),defaultResourceName:e.defaultResourceName};if(i=e.isComplexType?new de(a):new he(a),e.baseTypeName){i.baseTypeName=e.baseTypeName;var o=t._getEntityType(e.baseTypeName);o?r(t,e,i,o):v(t.deferredTypes,baseTypeName).push({json:e,stype:i})}else r(t,e,i,null);return i}function r(t,e,n,i){e.validators&&(n.validators=e.validators.map(te.fromJSON)),i&&(n.baseEntityType=i,i.dataProperties.forEach(function(t){var e=new me(t);e.isInherited=!0,n.addProperty(e)}),i.navigationProperties.forEach(function(t){var e=new ve(t);e.isInherited=!0,n.addProperty(e)})),e.dataProperties.forEach(function(t){n.addProperty(me.fromJSON(t))});var a=!e.isComplexType;a&&e.navigationProperties&&e.navigationProperties.forEach(function(t){n.addProperty(ve.fromJSON(t))}),t.addEntityType(n);var o=t._deferredTypes,s=o[n.name];s&&(s.forEach(function(e){r(t,e.json,e.stype,n)}),delete o[n.name])}function i(t,e,n){if(K(e))return e;var r=t._shortNameMap[e];if(!r&&n)throw Error("Unable to locate 'entityTypeName' of: "+e);return r}var a=0,s=function(t){t=t||{},W(t).whereParam("namingConvention").isOptional().isInstanceOf(Te).withDefault(Te.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(Ee).withDefault(Ee.defaultInstance).applyAll(this),this.dataServices=[],this._resourceEntityTypeMap={},this._structuralTypeMap={},this._shortNameMap={},this._ctorRegistry={},this._incompleteTypeMap={},this._incompleteComplexTypeMap={},this._id=a++},u=s.prototype;return u._$typeName="MetadataStore",s.ANONTYPE_PREFIX="_IB_",u.addDataService=function(t,e){z(t,"dataService").isInstanceOf(ue).check(),z(e,"shouldOverwrite").isBoolean().isOptional().check();var n=this._getDataServiceIndex(t.serviceName);if(n>=0){if(!e)throw Error("A dataService with this name '"+t.serviceName+"' already exists in this MetadataStore");this.dataServices[n]=t}else this.dataServices.push(t)},u._getDataServiceIndex=function(t){return f(this.dataServices,function(e){return e.serviceName===t})},u.addEntityType=function(t){if(t instanceof he||t instanceof de||(t=t.isComplexType?new de(t):new he(t)),!t.isComplexType&&0===t.keyProperties.length)throw Error("Unable to add "+t.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.");if(t.metadataStore=this,t.isAnonymous||(this._structuralTypeMap[t.name]=t,this._shortNameMap[t.shortName]=t.name),t.getProperties().forEach(function(e){t._updateProperty(e),e.isUnmapped||t._mappedPropertiesCount++}),t._updateCps(),!t.isComplexType){t._updateNps();var e=t.defaultResourceName||t.baseEntityType&&t.baseEntityType.defaultResourceName;e&&!this.getEntityTypeNameForResourceName(e)&&this.setEntityTypeForResourceName(e,t.name),t.defaultResourceName=e,t.getEntityCtor()}t.baseEntityType&&t.baseEntityType.subtypes.push(t)},u.exportMetadata=function(){var t=JSON.stringify({metadataVersion:B.metadataVersion,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:n(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},Y.stringifyPad);return t},u.importMetadata=function(t){if(this._deferredTypes={},t.schema)return fe.parse(this,t.schema);var n="string"==typeof t?JSON.parse(t):t;if(n.metadataVersion&&n.metadataVersion!==B.metadataVersion){var r=D("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",n.metadataVersion,B.metadataVersion);throw Error(r)}var i=n.namingConvention,a=n.localQueryComparisonOptions;if(this.isEmpty())this.namingConvention=Y._fetchObject(Te,i)||Te.defaultInstance,this.localQueryComparisonOptions=Y._fetchObject(Ee,a)||Ee.defaultInstance;else{if(i&&this.namingConvention.name!==i)throw Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore");if(a&&this.localQueryComparisonOptions.name!==a)throw Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore")}var s=this;n.dataServices&&n.dataServices.forEach(function(t){t=ue.fromJSON(t),s.addDataService(t,!0)});var u=this._structuralTypeMap;return n.structuralTypes.forEach(function(t){var n=e(s,t);u[n.name]=n}),o(this._resourceEntityTypeMap,n.resourceEntityTypeMap),o(this._incompleteTypeMap,n.incompleteTypeMap),this},s.importMetadata=function(t){var e=new le;return e.importMetadata(t),e},u.hasMetadataFor=function(t){return!!this.getDataService(t)},u.getDataService=function(t){return z(t,"serviceName").isString().check(),t=ue._normalizeServiceName(t),l(this.dataServices,function(e){return e.serviceName===t})},u.fetchMetadata=function(t,e,n){if(z(t,"dataService").isString().or().isInstanceOf(ue).check(),z(e,"callback").isFunction().isOptional().check(),z(n,"errorCallback").isFunction().isOptional().check(),"string"==typeof t&&(t=this.getDataService(t)||new ue({serviceName:t})),t=ue.resolve([t]),this.hasMetadataFor(t.serviceName))throw Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+t.serviceName);return t.adapterInstance.fetchMetadata(this,t).then(function(t){return e&&e(t),ye.resolve(t)}).fail(function(t){return n&&n(t),ye.reject(t)})},u.trackUnmappedType=function(t,e){z(t,"entityCtor").isFunction().check(),z(e,"interceptor").isFunction().isOptional().check();var n=new he(this);n._setCtor(t,e)},u.registerEntityTypeCtor=function(t,e,n){z(t,"structuralTypeName").isString().check(),z(e,"aCtor").isFunction().isOptional().check(),z(n,"initializationFn").isOptional().isFunction().or().isString().check();var r=i(this,t,!1),a=r||t;if(this._ctorRegistry[a]={ctor:e,initFn:n},r){var o=this._structuralTypeMap[r];o&&o.getCtor(!0)}},u.toQueryString=function(t){if(!t)throw Error("query cannot be empty");if("string"==typeof t)return t;if(t instanceof Se)return t._toUri(this);throw Error("unable to recognize query parameter as either a string or an EntityQuery")},u.isEmpty=function(){return x(this._structuralTypeMap)},u.getEntityType=function(t,e){return z(t,"structuralTypeName").isString().check(),z(e,"okIfNotFound").isBoolean().isOptional().check(!1),this._getEntityType(t,e)},u._getEntityType=function(t,e){var n=i(this,t,!1),r=this._structuralTypeMap[n];if(!r){if(e)return null;var a=D("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",t);throw Error(a)}if(r.length){var o=r.join(",");throw Error("There are multiple types with this 'shortName': "+o)}return r},u.getEntityTypes=function(){return t(this._structuralTypeMap)},u.getIncompleteNavigationProperties=function(){return n(this._incompleteTypeMap,function(t,e){return e})},u.getEntityTypeNameForResourceName=function(t){return z(t,"resourceName").isString().check(),this._resourceEntityTypeMap[t]},u.setEntityTypeForResourceName=function(t,e){z(t,"resourceName").isString().check(),z(e,"entityTypeOrName").isInstanceOf(he).or().isString().check();var n;n=e instanceof he?e.name:i(this,e,!0),this._resourceEntityTypeMap[t]=n;var r=this._getEntityType(n,!0);r&&!r.defaultResourceName&&(r.defaultResourceName=t)},u._getCtorRegistration=function(t){var e=metadataStore._ctorRegistry[t.name]||metadataStore._ctorRegistry[t.shortName];e.ctor||t.getEntityCtor()},u._checkEntityType=function(t){if(!t.entityType){var e=t.prototype._$typeName;if(!e)throw Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method");var n=this._getEntityType(e);n&&(t.entityType=n)}},s}(),fe=function(){function t(t,n){t._entityTypeResourceMap={},y(n).forEach(function(n){if(n.cSpaceOSpaceMapping){var i=JSON.parse(n.cSpaceOSpaceMapping),a={};i.forEach(function(t){a[t[0]]=t[1]}),n.cSpaceOSpaceMapping=a}n.entityContainer&&y(n.entityContainer).forEach(function(e){y(e.entitySet).forEach(function(e){var r=d(e.entityType,n).typeName;t.setEntityTypeForResourceName(e.name,r),t._entityTypeResourceMap[r]=e.name})}),n.complexType&&y(n.complexType).forEach(function(e){r(e,n,t)}),n.entityType&&y(n.entityType).forEach(function(r){e(r,n,t)})});var i=t.getIncompleteNavigationProperties();if(i.length>0)throw Error("Bad nav properties");return t}function e(t,e,r){var i=t.name,a=m(i,e),o=new he({shortName:i,namespace:a,isAbstract:t.abstract&&"true"===t.abstract});if(t.baseType){var s=d(t.baseType,e).typeName;o.baseTypeName=s;var u=r._getEntityType(s,!0);if(u)n(o,t,e,r,u);else{var p=r._deferredTypes[s];p||(p=[],r._deferredTypes[s]=p),p.push({entityType:o,csdlEntityType:t})}}else n(o,t,e,r,null);return o}function n(t,e,r,o,s){var p=[];s&&(t.baseEntityType=s,t.autoGeneratedKeyType=s.autoGeneratedKeyType,p=s.keyProperties.map(i("name")),s.dataProperties.forEach(function(e){var n=new me(e);n.isInherited=!0,t.addProperty(n)}),s.navigationProperties.forEach(function(e){var n=new ve(e);n.isInherited=!0,t.addProperty(n)}));var c=e.key?y(e.key.propertyRef).map(i("name")):[];c=p.concat(c),y(e.property).forEach(function(e){a(t,e,r,c)}),y(e.navigationProperty).forEach(function(e){u(t,e,r)}),o.addEntityType(t),t.defaultResourceName=o._entityTypeResourceMap[t.name];var l=o._deferredTypes,f=l[t.name];f&&(f.forEach(function(e){n(e.entityType,e.csdlEntityType,r,o,t)}),delete l[t.name])}function r(t,e,n){var r=t.name,i=m(r,e),o=new de({shortName:r,namespace:i});return y(t.property).forEach(function(t){a(o,t,e)}),n.addEntityType(o),o}function a(t,e,n,r){var i,a=e.type.split(".");return 2==a.length?i=o(t,e,r):p(e,n)?(i=o(t,e,r),i&&(i.enumType=e.type)):i=s(t,e,n),i&&(t.addProperty(i),c(i)),i}function o(t,e,n){var r=ce.fromEdmDataType(e.type);if(null==r)return t.warnings.push("Unable to recognize DataType for property: "+e.name+" DateType: "+e.type),null;var i="true"===e.nullable||null==e.nullable,a=null!=n&&n.indexOf(e.name)>=0;a&&t.autoGeneratedKeyType==ge.None&&f(e)&&(t.autoGeneratedKeyType=ge.Identity);var o=e.maxLength;o=null==o||"Max"===o?null:parseInt(o);var s=new me({nameOnServer:e.name,dataType:r,isNullable:i,isPartOfKey:a,maxLength:o,concurrencyMode:e.concurrencyMode});return r===ce.Undefined&&(s.rawTypeName=e.type),s}function s(t,e,n){var r=d(e.type,n).typeName,i=new me({nameOnServer:e.name,complexTypeName:r,isNullable:!1});return i}function u(t,e,n){var r=h(e,n),a=l(r.end,function(t){return t.role===e.toRole}),o=!("*"===a.multiplicity),s=d(a.type,n).typeName,u=r.referentialConstraint;if(!u){if("*"==r.end[0].multiplicity&&"*"==r.end[1].multiplicity)return;throw Error("Foreign Key Associations must be turned on for this model")}var p,c={nameOnServer:e.name,entityTypeName:s,isScalar:o,associationName:r.name},f=u.principal,m=u.dependent;e.fromRole===f.role?(p=y(f.propertyRef),c.invForeignKeyNamesOnServer=p.map(i("name"))):(p=y(m.propertyRef),c.foreignKeyNamesOnServer=p.map(i("name")));var v=new ve(c);return t.addProperty(v),v}function p(t,e){if(!e.enumType)return!1;var n=y(e.enumType),r=t.type.split("."),i=r[r.length-1];return n.some(function(t){return t.name===i})}function c(t){var e;if(t.isNullable||t.validators.push(te.required()),!t.isComplexProperty){if(t.dataType===ce.String)if(t.maxLength){var n={maxLength:t.maxLength};e=te.maxLength(n)}else e=te.string();else e=t.dataType.validatorCtor();t.validators.push(e)}}function f(t){var e=l(Object.keys(t),function(t){return t.indexOf("StoreGeneratedPattern")>=0});if(e)return"Identity"===t[e];var n=t.extensions;if(!n)return!1;var r=l(n,function(t){return"StoreGeneratedPattern"===t.name&&"Identity"===t.value});return!!r}function h(t,e){var n=d(t.relationship,e).shortTypeName,r=e.association;if(!r)return null;Array.isArray(r)||(r=[r]);var i=l(r,function(t){return t.name===n});return i}function d(t,e){if(!t)return null;if(I(t,le.ANONTYPE_PREFIX))return{shortTypeName:t,namespace:"",typeName:t,isAnon:!0};var n=t.split(",")[0],r=n.split(".");if(r.length>1){var i,a=r[r.length-1];if(e)i=m(a,e);else{var o=r.slice(0,r.length-1);i=o.join(".")}return{shortTypeName:a,namespace:i,typeName:j(a,i)}}return{shortTypeName:t,namespace:"",typeName:t}}function m(t,e){var n,r=e.cSpaceOSpaceMapping;if(r){var i=r[e.namespace+"."+t];n=i&&i.substr(0,i.length-(t.length+1))}return n||e.namespace}var v=S(function(t){return t&&d(t).typeName});return{parse:t,normalizeTypeName:v}}(),he=function(){function e(){return function(){}}function n(t){return t.filter(function(t){return!t.isInherited})}function a(t,e,n){serverPropName=n+"OnServer";var r=e[n];if(r&&r.length){if(e.isUnmapped)return;var i=y(r).map(function(n){var r=t.clientPropertyNameToServer(n,e),i=t.serverPropertyNameToClient(r,e);if(n!==i)throw Error("NamingConvention for this client property name does not roundtrip properly:"+n+"-->"+i);return r});e[serverPropName]=Array.isArray(r)?i:i[0]}else{if(serverName=e[serverPropName],!serverName||0==serverName.length)return;var a=y(serverName).map(function(n){var r=t.serverPropertyNameToClient(n,e),i=t.clientPropertyNameToServer(r,e);if(n!==i)throw Error("NamingConvention for this server property name does not roundtrip properly:"+n+"-->"+i);return r});e[n]=Array.isArray(serverName)?a:a[0]}}function o(t,e){var n=e._getEntityType(t.complexTypeName,!0);if(!n)return!1;if(!(n instanceof de))throw Error("Unable to resolve ComplexType with the name: "+t.complexTypeName+" for the property: "+property.name);return t.dataType=n,t.defaultValue=null,!0}function s(t,e){var n=e._getEntityType(t.entityTypeName,!0);if(!n)return!1;t.entityType=n;var r=l(n.navigationProperties,function(e){return e.associationName===t.associationName&&(e.name!=t.name||e.entityTypeName!=t.entityTypeName)});return t.inverse=r,r||t.invForeignKeyNames.forEach(function(e){var r=n.getDataProperty(e);r.invEntityType=t.parentType}),!0}function u(t){if(!t.foreignKeyProperties){var e=c(t);e&&e.forEach(function(e){e.relatedNavigationProperty=t,t.parentType.foreignKeyProperties.push(e),t.relatedDataProperties?t.relatedDataProperties.push(e):t.relatedDataProperties=[e]})}}function c(t){var e=t.foreignKeyNames;if(0==e.length)return t.foreignKeyProperties=[],t.foreignKeyProperties;var n=!0,r=t.parentType,i=e.map(function(t){var e=r.getDataProperty(t);return n=n&&!!e,e});return n?(t.foreignKeyProperties=i,i):null}function f(t,e){var n=t.getPropertyNames(),r=Z.getDefaultInstance().getTrackablePropertyNames(e);r.forEach(function(e){if(-1==n.indexOf(e)){var r=new me({name:e,dataType:ce.Undefined,isNullable:!0,isUnmapped:!0});t.addProperty(r)}})}var h=0,d=function(t){if(arguments.length>1)throw Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.");"MetadataStore"===t._$typeName?(this.metadataStore=t,this.shortName="Anon_"+ ++h,this.namespace="",this.isAnonymous=!0):W(t).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(!1).whereParam("autoGeneratedKeyType").isEnumOf(ge).isOptional().withDefault(ge.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().applyAll(this),this.name=j(this.shortName,this.namespace),this.dataProperties=[],this.navigationProperties=[],this.complexProperties=[],this.keyProperties=[],this.foreignKeyProperties=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.validators=[],this.warnings=[],this._mappedPropertiesCount=0,this.subtypes=[],R(this,t.dataProperties,me),R(this,t.navigationProperties,ve)},m=d.prototype;return m._$typeName="EntityType",m.setProperties=function(t){W(t).whereParam("autoGeneratedKeyType").isEnumOf(ge).isOptional().whereParam("defaultResourceName").isString().isOptional().applyAll(this),t.defaultResourceName&&(this.defaultResourceName=t.defaultResourceName)},m.isSubtypeOf=function(t){z(t,"entityType").isInstanceOf(he).check();var e=this;do{if(e===t)return!0;e=e.baseEntityType}while(e);return!1},m.getSelfAndSubtypes=function(){var t=[this];return this.subtypes.forEach(function(e){var n=e.getSelfAndSubtypes();t.push.apply(t,n)}),t},m.addProperty=function(t){if(z(t,"dataProperty").isInstanceOf(me).or().isInstanceOf(ve).check(),this.metadataStore&&!t.isUnmapped)throw Error("The '"+this.name+"' EntityType has already been added to a MetadataStore and therefore no additional properties may be added to it.");if(t.parentType){if(t.parentType!==this)throw Error("This dataProperty has already been added to "+t.parentType.name);return this}return t.parentType=this,t.isDataProperty?this._addDataProperty(t):this._addNavigationProperty(t),this
},m.createEntity=function(e){var n=this._createEntityCore();return e&&t(e,function(t,e){n.setProperty(t,e)}),n.entityAspect._postInitialize(),n},m._createEntityCore=function(){var t=this.getEntityCtor(),e=new t;return new ie(e),e},m.getCtor=m.getEntityCtor=function(t){if(this._ctor&&!t)return this._ctor;var n=this.metadataStore._ctorRegistry,r=n[this.name]||n[this.shortName]||{},i=r.ctor||this._ctor;if(!i){var a=Z.getDefaultInstance().createCtor;i=a?a(this):e()}return r.initFn&&(i._$initializationFn=r.initFn),i.prototype._$typeName=this.name,this._setCtor(i),i},m._setCtor=function(t,e){var n=new t,r=t.prototype;"EntityType"==this._$typeName?(f(this,n),r.entityType=this):(f(this,n),r.complexType=this),r._$interceptor=e?e:V,Z.getDefaultInstance().initializeEntityPrototype(r),this._ctor=t},m.addValidator=function(t,e){z(t,"validator").isInstanceOf(te).check(),z(e,"property").isOptional().isString().or().isEntityProperty().check(),e?("string"==typeof e&&(e=this.getProperty(e,!0)),e.validators.push(t)):this.validators.push(t)},m.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)},m.getPropertyNames=function(){return this.getProperties().map(i("name"))},m.getDataProperty=function(t,e){var n=e?"nameOnServer":"name";return l(this.dataProperties,r(n,t))},m.getNavigationProperty=function(t,e){var n=e?"nameOnServer":"name";return l(this.navigationProperties,r(n,t))},m.getProperty=function(t,e){e=e||!1;var n=Array.isArray(t)?t:t.trim().split("."),i=n[0],a=l(this.getProperties(),r("name",i));if(1===n.length){if(a)return a;if(e)throw Error("unable to locate property: "+i+" on entityType: "+this.name);return null}if(a){n.shift();var o=a.isNavigationProperty?a.entityType:a.dataType;if(o)return o.getProperty(n,e);throw Error("should not get here - unknown property type for: "+a.name)}if(e)throw Error("unable to locate property: "+i+" on type: "+this.name);return null},m.toString=function(){return this.name},m.toJSON=function(){return p(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:!1,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:n,navigationProperties:n,validators:null})},m._clientPropertyPathToServer=function(t){var e=this.metadataStore.namingConvention.clientPropertyNameToServer,n=this,r=t.split(".").map(function(t){var r=n.getProperty(t);return e(t,r)}).join("/");return r},m._updateProperty=function(t){var e=this.metadataStore.namingConvention;a(e,t,"name"),t.isNavigationProperty&&(a(e,t,"foreignKeyNames"),a(e,t,"invForeignKeyNames"),u(t))},m._checkNavProperty=function(t){if(t.isNavigationProperty){if(t.parentType!=this)throw Error(D("The navigationProperty '%1' is not a property of entity type '%2'",t.name,this.name));return t}if("string"==typeof t){var e=this.getProperty(t);if(e&&e.isNavigationProperty)return e}throw Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty")},m._addDataProperty=function(t){this.dataProperties.push(t),t.isPartOfKey&&this.keyProperties.push(t),t.isComplexProperty&&this.complexProperties.push(t),t.concurrencyMode&&"None"!==t.concurrencyMode&&this.concurrencyProperties.push(t),t.isUnmapped&&this.unmappedProperties.push(t)},m._addNavigationProperty=function(t){this.navigationProperties.push(t),K(t.entityTypeName)||(t.entityTypeName=j(t.entityTypeName,this.namespace))},m._updateCps=function(){var t=this.metadataStore,e=t._incompleteComplexTypeMap;this.complexProperties.forEach(function(n){n.complexType||o(n,t)||v(e,n.complexTypeName).push(n)}),this.isComplexType&&((e[this.name]||[]).forEach(function(e){o(e,t)}),delete e[this.name])},m._updateNps=function(){var t=this.metadataStore,e=t._incompleteTypeMap;this.navigationProperties.forEach(function(n){n.entityType||s(n,t)||v(e,n.entityTypeName).push(n)}),(e[this.name]||[]).forEach(function(e){s(e,t)}),delete e[this.name]},d}(),de=function(){var e=function(t){if(arguments.length>1)throw Error("The ComplexType ctor has a single argument that is a configuration object.");W(t).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().applyAll(this),this.name=j(this.shortName,this.namespace),this.isComplexType=!0,this.dataProperties=[],this.complexProperties=[],this.validators=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.navigationProperties=[],this.keyProperties=[],R(this,t.dataProperties,me)},n=e.prototype;return n.createInstance=function(e){var n=this._createInstanceCore();return e&&t(e,function(t,e){n.setProperty(t,e)}),n.complexAspect._postInitialize(),n},n._createInstanceCore=function(t,e){var n=this.getCtor(),r=new n;return new ae(r,t,e),t&&r.complexAspect._postInitialize(),r},n.addProperty=function(t){if(z(t,"dataProperty").isInstanceOf(me).check(),this.metadataStore&&!t.isUnmapped)throw Error("The '"+this.name+"' ComplexType has already been added to a MetadataStore and therefore no additional properties may be added to it.");if(t.parentType){if(t.parentType!==this)throw Error("This dataProperty has already been added to "+property.parentType.name);return this}return this._addDataProperty(t),this},n.getProperties=function(){return this.dataProperties},n.addValidator=he.prototype.addValidator,n.getProperty=he.prototype.getProperty,n.getPropertyNames=he.prototype.getPropertyNames,n._addDataProperty=he.prototype._addDataProperty,n._updateProperty=he.prototype._updateProperty,n._updateCps=he.prototype._updateCps,n.getCtor=he.prototype.getEntityCtor,n._setCtor=he.prototype._setCtor,n.toJSON=function(){return p(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null})},n._$typeName="ComplexType",e}(),me=function(){var t=function(t){W(t).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(ce).isOptional().or().isString().or().isInstanceOf(de).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(!0).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(te).isArray().isOptional().withDefault([]).whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().whereParam("isScalar").isOptional().applyAll(this);var e=!(!this.name&&!this.nameOnServer);if(!e)throw Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property");if(this.complexTypeName)this.isComplexProperty=!0,this.dataType=null;else if("string"==typeof this.dataType){var n=ce.fromName(this.dataType);if(!n)throw Error("Unable to find a DataType enumeration by the name of: "+this.dataType);this.dataType=n}else this.dataType||(this.dataType=ce.String);if(null==this.defaultValue)if(this.isNullable)this.defaultValue=null;else if(this.isComplexProperty);else if(this.dataType===ce.Binary)this.defaultValue="AAAAAAAAJ3U=";else if(this.defaultValue=this.dataType.defaultValue,null==this.defaultValue)throw Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+this.name);this.isComplexProperty&&(this.isScalar=null==this.isScalar||this.isScalar===!0)},e=t.prototype;return e._$typeName="DataProperty",e.isDataProperty=!0,e.isNavigationProperty=!1,e.toJSON=function(){return p(this,{name:null,dataType:function(t){return t&&t.parentEnum?t.name:void 0},complexTypeName:null,isNullable:!0,defaultValue:null,isPartOfKey:!1,isUnmapped:!1,concurrencyMode:null,maxLength:null,validators:null,enumType:null,rawTypeName:null,isScalar:null})},t.fromJSON=function(t){return t.dataType=ce.fromName(t.dataType),t.defaultValue&&t.dataType&&t.dataType.isDate&&(t.defaultValue=new Date(Date.parse(t.defaultValue))),t.validators&&(t.validators=t.validators.map(te.fromJSON)),new me(t)},t}(),ve=function(){var t=function(t){W(t).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(te).isArray().isOptional().withDefault([]).applyAll(this);var e=!(!this.name&&!this.nameOnServer);if(!e)throw Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property")},e=t.prototype;return e._$typeName="NavigationProperty",e.isDataProperty=!1,e.isNavigationProperty=!0,e.toJSON=function(){return p(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,foreignKeyNames:null,invForeignKeyNames:null})},t.fromJSON=function(t){return t.validators&&(t.validators=t.validators.map(te.fromJSON)),new ve(t)},t}(),ge=function(){var t=new X("AutoGeneratedKeyType");return t.None=t.addSymbol(),t.Identity=t.addSymbol(),t.KeyGenerator=t.addSymbol(),t.seal(),t}();(function(){function t(t,e){return null==e?!1:void 0!==e.entityType}function e(t,e){return null==e?!1:e.isDataProperty||e.isNavigationProperty}var n=$.prototype;n.isEntity=function(){return this._addContext({fn:t,msg:" must be an entity"})},n.isEntityProperty=function(){return this._addContext({fn:e,msg:" must be either a DataProperty or a NavigationProperty"})}})(),B.MetadataStore=le,B.EntityType=he,B.ComplexType=de,B.DataProperty=me,B.NavigationProperty=ve,B.AutoGeneratedKeyType=ge,le.normalizeTypeName=fe.normalizeTypeName;var Pe=function(){function t(t,e,n){var r=e.name+".."+e.parentType.name,i=t._tempIdMap[r];return i||n&&(i={entityType:e.parentType,propertyName:e.name,keyMap:{}},t._tempIdMap[r]=i),i}var e=function(){this._tempIdMap={}},n=e.prototype;return n.generateTempKeyValue=function(e,n){var r=e.keyProperties;if(r.length>1)throw Error("Ids can not be autogenerated for entities with multipart keys");var i,a=r[0],o=t(this,a,!0);if(null!=n&&(o.keyMap[""+n]||(i=n)),void 0===i){var s=a.dataType;if(!s.getNext)throw Error("Cannot use a property with a dataType of: "+(""+s)+" for id generation");i=s.getNext(this)}return o.keyMap[""+i]=!0,i},n.getTempKeys=function(){var t=[];for(var e in this._tempIdMap){var n=this._tempIdMap[e],r=n.entityType;for(var i in n.keyMap)t.push(new oe(r,[i]))}return t},n.isTempKey=function(e){var n=e.entityType.keyProperties;if(n.length>1)return!1;var r=n[0],i=t(this,r);return i?void 0!==i.keyMap[""+e.values[0]]:!1},Y.registerType(e,"KeyGenerator"),e}();B.KeyGenerator=Pe;var Ee=function(){var t=function(t){W(t||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this),this.name||(this.name=_()),Y._storeObject(this,e._$typeName,this.name)},e=t.prototype;return e._$typeName="LocalQueryComparisonOptions",t.caseInsensitiveSQL=new t({name:"caseInsensitiveSQL",isCaseSensitive:!1,usesSql92CompliantStringComparison:!0}),t.defaultInstance=new t(t.caseInsensitiveSQL),e.setAsDefault=function(){return u(this,t)},t}();B.LocalQueryComparisonOptions=Ee;var Te=function(){var t=function(t){W(t||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this),this.name||(this.name=_()),Y._storeObject(this,e._$typeName,this.name)},e=t.prototype;return e._$typeName="NamingConvention",t.none=new t({name:"noChange",serverPropertyNameToClient:function(t){return t},clientPropertyNameToServer:function(t){return t}}),t.camelCase=new t({name:"camelCase",serverPropertyNameToClient:function(t){return t.substr(0,1).toLowerCase()+t.substr(1)},clientPropertyNameToServer:function(t){return t.substr(0,1).toUpperCase()+t.substr(1)}}),t.defaultInstance=new t(t.none),e.setAsDefault=function(){return u(this,t)},t}();B.NamingConvention=Te;var Se=function(){function e(n,r,i,a){var o=i._$typeName||i.parentEnum&&i.parentEnum.name,s=o&&o.substr(0,1).toLowerCase()+o.substr(1);if(a&&s!=a)throw Error("Invalid value for property: "+a);if(s){var u=r[s];if(void 0===u)throw Error("Invalid config property: "+s);null===u?n[s]=i:u(n,i)}else t(i,function(t,i){e(n,r,i,t)})}function n(t){return z(t,"propertyPaths").isOptional().isString().or().isArray().isString().check(),"string"==typeof t&&(t=t.split(",")),t=t.map(function(t){return t.trim()})}function r(t){var e=t.entityType,n=e.keyProperties.map(function(e){return be.create(e.name,we.Equals,t.getProperty(e.name))}),r=be.and(n);return r}function i(t,e,n){var r,i=t._clone();return e?(r=xe.create(e,n),i.orderByClause?i.orderByClause.addClause(r):i.orderByClause=r,i):(i.orderByClause=null,i)}function a(t,e){var n=t._clone();return e?(n.selectClause=new ke(e),n):(n.selectClause=null,n)}function s(t,e){var n=t._clone();return e?(n.expandClause=new De(e),n):(n.expandClause=null,n)}function u(t,e){var n=t._clone();return n.parameters=e,n}function p(t){var e=t.entityType.keyProperties,n=d(e,t.values,function(t,e){return be.create(t.name,we.Equals,e)}),r=be.and(n);return r}function c(t,e){if(e.isScalar){if(0===e.foreignKeyNames.length)return null;var n=e.foreignKeyNames.map(function(e){return t.getProperty(e)}),r=new oe(e.entityType,n);return p(r)}var i=e.inverse,a=i?i.foreignKeyNames:e.invForeignKeyNames;if(0===a.length)return null;var o=t.entityAspect.getKey().values,s=d(a,o,function(t,e){return be.create(t,we.Equals,e)});return be.and(s)}var y=function(t){z(t,"resourceName").isOptional().isString().check(),this.resourceName=t,this.entityType=null,this.wherePredicate=null,this.orderByClause=null,this.selectClause=null,this.skipCount=null,this.takeCount=null,this.expandClause=null,this.parameters={},this.inlineCountEnabled=!1,this.entityManager=null},l=y.prototype;return l._$typeName="EntityQuery",l.from=function(t){z(t,"resourceName").isString().check();var e=this.resourceName;if(e&&e!==t)throw Error("This query already has an resourceName - the resourceName may only be set once per query");var n=this._clone();return n.resourceName=t,n},y.from=function(t){return z(t,"resourceName").isString().check(),new Se(t)},l.toType=function(t){z(t,"entityType").isString().or().isInstanceOf(he).check();var e=this._clone();return e.toEntityType=t,e},l.where=function(t){var e=this._clone();if(0===arguments.length)return e.wherePredicate=null,e;var n;return n=be.isPredicate(t)?t:be.create(G(arguments)),e.entityType&&n.validate(e.entityType),e.wherePredicate=e.wherePredicate?new Ae("and",[e.wherePredicate,n]):n,e},l.orderBy=function(t){return i(this,n(t))},l.orderByDesc=function(t){return i(this,n(t),!0)},l.select=function(t){return a(this,n(t))},l.skip=function(t){z(t,"count").isOptional().isNumber().check();var e=this._clone();return e.skipCount=0===arguments.length?null:t,e},l.top=function(t){return this.take(t)},l.take=function(t){z(t,"count").isOptional().isNumber().check();var e=this._clone();return e.takeCount=0===arguments.length?null:t,e},l.expand=function(t){return s(this,n(t))},l.withParameters=function(t){return z(t,"parameters").isObject().check(),u(this,t)},l.inlineCount=function(t){void 0===t&&(t=!0);var e=this._clone();return e.inlineCountEnabled=t,e},l.using=function(t){if(!t)return this;var n=this._clone();return e(n,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(t,e){t.queryOptions=(t.queryOptions||new Ke).using(e)},mergeStrategy:function(t,e){t.queryOptions=(t.queryOptions||new Ke).using(e)},jsonResultsAdapter:function(t,e){t.dataService=(t.dataService||new ue).using({jsonResultsAdapter:e})}},t),n},l.execute=function(t,e){if(!this.entityManager)throw Error("An EntityQuery must have its EntityManager property set before calling 'execute'");return this.entityManager.executeQuery(this,t,e)},l.executeLocally=function(){if(!this.entityManager)throw Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'");return this.entityManager.executeQueryLocally(this)},y.fromEntities=function(t){z(t,"entities").isEntity().or().isNonEmptyArray().isEntity().check(),Array.isArray(t)||(t=G(arguments));var e=t[0],n=new Se(e.entityType.defaultResourceName),i=t.map(function(t){return r(t)}),a=be.or(i);n=n.where(a);var o=e.entityAspect.entityManager;return o&&(n=n.using(o)),n},y.fromEntityKey=function(t){z(t,"entityKey").isInstanceOf(oe).check();var e=new Se(t.entityType.defaultResourceName),n=p(t);return e=e.where(n)},y.fromEntityNavigation=function(t,e){z(t,"entity").isEntity().check(),z(e,"navigationProperty").isInstanceOf(ve).check();var n=t.entityType._checkNavProperty(e),r=new Se(n.entityType.defaultResourceName),i=c(t,n);r=r.where(i);var a=t.entityAspect.entityManager;return a&&(r=r.using(a)),r},l._getFromEntityType=function(t,e){var n=this.entityType;if(n)return n;var r=this.resourceName;if(!r)throw Error("There is no resourceName for this query");if(t.isEmpty()){if(e)throw Error("There is no metadata available for this query");return null}var i=t.getEntityTypeNameForResourceName(r);if(n=i?t._getEntityType(i):this._getToEntityType(t,!0),!n){if(e)throw Error(D("Cannot find an entityType for either entityTypeName: '%1' or resourceName: '%2'",i,r));return null}return this.entityType=n,n},l._getToEntityType=function(t,e){return this.toEntityType instanceof he?this.toEntityType:this.toEntityType?(this.toEntityType=t._getEntityType(this.toEntityType,!1),this.toEntityType):e?null:!this.selectClause&&this._getFromEntityType(t,!1)},l._clone=function(){var t=new Se;return t.resourceName=this.resourceName,t.entityType=this.entityType,t.wherePredicate=this.wherePredicate,t.orderByClause=this.orderByClause,t.selectClause=this.selectClause,t.skipCount=this.skipCount,t.takeCount=this.takeCount,t.expandClause=this.expandClause,t.inlineCountEnabled=this.inlineCountEnabled,t.parameters=o({},this.parameters),t.queryOptions=this.queryOptions,t.entityManager=this.entityManager,t.dataService=this.dataService,t.toEntityType=this.toEntityType,t},l._toUri=function(t){function e(){var t=y.wherePredicate;return t?(y.entityType&&t.validate(y.entityType),t.toOdataFragment(c)):""}function n(){return y.inlineCountEnabled?y.inlineCountEnabled?"allpages":"none":""}function r(){var t=y.orderByClause;return t?(y.entityType&&t.validate(y.entityType),t.toOdataFragment(c)):""}function i(){var t=y.selectClause;return t?(y.entityType&&t.validate(y.entityType),t.toOdataFragment(c)):""}function a(){var t=y.expandClause;return t?t.toOdataFragment(c):""}function s(){var t=y.skipCount;return t?""+t:""}function u(){var t=y.takeCount;return t?""+t:""}function p(t){var e=[];for(var n in t){var r=t[n];r&&e.push(n+"="+encodeURIComponent(r))}return e.length>0?"?"+e.join("&"):""}var c=this._getFromEntityType(t,!1);c||(c=new he(t));var y=this,l={};l.$filter=e(),l.$orderby=r(),l.$skip=s(),l.$top=u(),l.$expand=a(),l.$select=i(),l.$inlinecount=n(),l=o(l,this.parameters);var f=p(l);return this.resourceName+f},l._toFilterFunction=function(t){var e=this.wherePredicate;return e?(e.validate(t),e.toFunction(t)):null},l._toOrderByComparer=function(t){var e=this.orderByClause;return e?e.getComparer(t):null},y}(),_e=function(){var t={toupper:{fn:function(t){return t.toUpperCase()},dataType:ce.String},tolower:{fn:function(t){return t.toLowerCase()},dataType:ce.String},substring:{fn:function(t,e,n){return t.substring(e,n)},dataType:ce.String},substringof:{fn:function(t,e){return e.indexOf(t)>=0},dataType:ce.Boolean},length:{fn:function(t){return t.length},dataType:ce.Int32},trim:{fn:function(t){return t.trim()},dataType:ce.String},concat:{fn:function(t,e){return t.concat(e)},dataType:ce.String},replace:{fn:function(t,e,n){return t.replace(e,n)},dataType:ce.String},startswith:{fn:function(t,e){return I(t,e)},dataType:ce.Boolean},endswith:{fn:function(t,e){return k(t,e)},dataType:ce.Boolean},indexof:{fn:function(t,e){return t.indexOf(e)},dataType:ce.Int32},round:{fn:function(t){return Math.round(t)},dataType:ce.Int32},ceiling:{fn:function(t){return Math.ceil(t)},dataType:ce.Int32},floor:{fn:function(t){return Math.floor(t)},dataType:ce.Int32},second:{fn:function(t){return t.second},dataType:ce.Int32},minute:{fn:function(t){return t.minute},dataType:ce.Int32},day:{fn:function(t){return t.day},dataType:ce.Int32},month:{fn:function(t){return t.month},dataType:ce.Int32},year:{fn:function(t){return t.year},dataType:ce.Int32}};return t}(),Ne=function(){function t(t){var e=t.split(".");return 1===e.length?function(e){return e.getProperty(t)}:function(t){return L(t,e)}}var e=/^[a-z_][\w.$]*$/i,n=/('[^']*'|[^,]+)/g,r=/("[^"]*"|[^,]+)/g,i=function(i,a,o){var s=i.split(":");if(o&&(this.isValidated=!0),1==s.length){var u=s[0].trim();this.value=u;var p=u.substr(0,1),c="'"==p||'"'==p;if(c){var y=u.substr(1,u.length-2);this.fn=function(){return y},this.dataType=ce.String}else{var l=e.test(u);if(l){if(o&&null==o.getProperty(u,!1))return this.isValidated=!1,void 0;this.propertyPath=u,this.fn=t(u)}else{if(o)return this.isValidated=!1,void 0;this.fn=function(){return u},this.dataType=ce.fromValue(u)}}}else try{this.fnName=s[0].trim().toLowerCase();var f=_e[this.fnName];this.localFn=f.fn,this.dataType=f.dataType;var h=this;this.fn=function(t){var e=h.fnNodes.map(function(e){var n=e.fn(t);return n}),n=h.localFn.apply(null,e);return n};var d=a[s[1]].trim();"("==d.substr(0,1)&&(d=d.substr(1,d.length-2));var m=i.indexOf("'")>=0?n:r,v=d.match(m);this.fnNodes=v.map(function(t){return new Ne(t,a)})}catch(g){this.isValidated=!1}},a=i.prototype;return i.create=function(t,e,n){if("string"!=typeof t)return null;for(var r,i=/\([^()]*\)/,a=[],o=0;r=i.exec(t);){var s=r[0];a.push(s);var u=":"+o++;t=t.replace(s,u)}var p=new Ne(t,a,e);return!p.dataType&&n&&n.isStringFn&&(p.dataType=ce.String),p.isValidated===!1?null:p},a.toString=function(){if(this.fnName){var t=this.fnNodes.map(function(t){return""+t}),e=this.fnName+"("+t.join(",")+")";return e}return this.value},a.updateWithEntityType=function(t){if(this.propertyPath){if(t.isAnonymous)return;var e=t.getProperty(this.propertyPath);if(!e){var n=D("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",t.name,this.propertyPath);throw Error(n)}this.dataType=e.dataType}},a.toOdataFragment=function(t){if(this.updateWithEntityType(t),this.fnName){var e=this.fnNodes.map(function(e){return e.toOdataFragment(t)}),n=this.fnName+"("+e.join(",")+")";return n}var r=this.value.substr(0,1);return"'"===r||'"'===r?this.value:this.value==this.propertyPath?t._clientPropertyPathToServer(this.propertyPath):this.value},a.validate=function(t){if(void 0===this.isValidated)if(this.isValidated=!0,this.propertyPath){var e=t.getProperty(this.propertyPath,!0);this.dataType=e.isDataProperty?e.dataType:e.entityType}else this.fnNodes&&this.fnNodes.forEach(function(e){e.validate(t)})},i}(),we=function(){var t=new X("FilterQueryOp");return t.Equals=t.addSymbol({operator:"eq",aliases:["=="]}),t.NotEquals=t.addSymbol({operator:"ne",aliases:["!="]}),t.GreaterThan=t.addSymbol({operator:"gt",aliases:[">"]}),t.LessThan=t.addSymbol({operator:"lt",aliases:["<"]}),t.GreaterThanOrEqual=t.addSymbol({operator:"ge",aliases:[">="]}),t.LessThanOrEqual=t.addSymbol({operator:"le",aliases:["<="]}),t.Contains=t.addSymbol({operator:"substringof",isFunction:!0,isStringFn:!0}),t.StartsWith=t.addSymbol({operator:"startswith",isFunction:!0,isStringFn:!0}),t.EndsWith=t.addSymbol({operator:"endswith",isFunction:!0,isStringFn:!0}),t.IsTypeOf=t.addSymbol({operator:"isof",isFunction:!0,aliases:["isTypeOf"]}),t.seal(),t._map=function(){var e={};return t.getSymbols().forEach(function(t){e[t.name.toLowerCase()]=t,e[t.operator.toLowerCase()]=t,t.aliases&&t.aliases.forEach(function(n){e[n.toLowerCase()]=t})}),e}(),t.from=function(e){return t.contains(e)?e:t._map[e.toLowerCase()]},t}(),Oe=function(){var t=new X("BooleanQueryOp");return t.And=t.addSymbol({operator:"and",aliases:["&&"]}),t.Or=t.addSymbol({operator:"or",aliases:["||"]}),t.Not=t.addSymbol({operator:"not",aliases:["~","!"]}),t.seal(),t._map=function(){var e={};return t.getSymbols().forEach(function(t){e[t.name.toLowerCase()]=t,e[t.operator.toLowerCase()]=t,t.aliases&&t.aliases.forEach(function(n){e[n.toLowerCase()]=t})}),e}(),t.from=function(e){return t.contains(e)?e:t._map[e.toLowerCase()]},t}(),be=function(){function t(t){if(1===t.length&&Array.isArray(t[0]))return t[0];var e=G(t);return be.isPredicate(e[0])?e:[be.create(e)]}var e=function(t,e,n,r){return arguments[0].prototype===!0?this:new Ce(t,e,n,r)},n=e.prototype;return e.isPredicate=function(t){return t instanceof be},e.create=function(t,e,n,r){return Array.isArray(t)?(r=4===t.length?t[3]:!1,new Ce(t[0],t[1],t[2],r)):new Ce(t,e,n,r)},e.and=function(e){return e=t(arguments),1===e.length?e[0]:new Ae("and",e)},e.or=function(e){return e=t(arguments),1===e.length?e[0]:new Ae("or",e)},e.not=function(t){return new Ae("not",[t])},n.and=function(n){return n=t(arguments),n.unshift(this),e.and(n)},n.or=function(n){return n=t(arguments),n.unshift(this),e.or(n)},n.not=function(){return new Ae("not",[this])},e}(),Ce=function(){function t(t,a,o){var s,u=t.metadataStore.localQueryComparisonOptions,p=q(o);switch(a){case we.Equals:s=function(t,n){return t&&"string"==typeof t?e(t,n,u):p(t)==p(n)};break;case we.NotEquals:s=function(t,n){return t&&"string"==typeof t?!e(t,n,u):p(t)!=p(n)};break;case we.GreaterThan:s=function(t,e){return p(t)>p(e)};break;case we.GreaterThanOrEqual:s=function(t,e){return p(t)>=p(e)};break;case we.LessThan:s=function(t,e){return p(t)<p(e)};break;case we.LessThanOrEqual:s=function(t,e){return p(t)<=p(e)};break;case we.StartsWith:s=function(t,e){return n(t,e,u)};break;case we.EndsWith:s=function(t,e){return r(t,e,u)};break;case we.Contains:s=function(t,e){return i(t,e,u)};break;default:throw Error("Unknown FilterQueryOp: "+a)}return s}function e(t,e,n){return null==e?!1:("string"!=typeof e&&(e=""+e),n.usesSql92CompliantStringComparison&&(t=(t||"").trim(),e=(e||"").trim()),n.isCaseSensitive||(t=(t||"").toLowerCase(),e=(e||"").toLowerCase()),t==e)}function n(t,e,n){return n.isCaseSensitive||(t=(t||"").toLowerCase(),e=(e||"").toLowerCase()),I(t,e)}function r(t,e,n){return n.isCaseSensitive||(t=(t||"").toLowerCase(),e=(e||"").toLowerCase()),k(t,e)}function i(t,e,n){return n.isCaseSensitive||(t=(t||"").toLowerCase(),e=(e||"").toLowerCase()),t.indexOf(e)>=0}var a=function(t,e,n,r){if(z(t,"propertyOrExpr").isString().isOptional().check(),z(e,"operator").isEnumOf(we).or().isString().check(),z(n,"value").isRequired(!0).check(),z(r).isOptional().isBoolean().check(),this._filterQueryOp=we.from(e),!this._filterQueryOp)throw Error("Unknown query operation: "+e);if(t)this._propertyOrExpr=t,this._fnNode1=Ne.create(t,null,this._filterQueryOp);else if(this._filterQueryOp!==we.IsTypeOf)throw Error("propertyOrExpr cannot be null except when using the 'IsTypeOf' operator");this._value=n,this._valueIsLiteral=r},o=new be({prototype:!0});return a.prototype=o,o.toOdataFragment=function(t){if(this._filterQueryOp==we.IsTypeOf){var e=t.metadataStore.getEntityType(this._value),n=e.namespace+"."+e.shortName;return this._filterQueryOp.operator+"("+ce.String.fmtOData(n)+")"}var r,i=this._fnNode1&&this._fnNode1.toOdataFragment(t);if(void 0!==this.fnNode2||this._valueIsLiteral||(this.fnNode2=Ne.create(this._value,t)),this.fnNode2)r=this.fnNode2.toOdataFragment(t);else{var a=this._fnNode1.dataType||ce.fromValue(this._value);r=a.fmtOData(this._value)}return this._filterQueryOp.isFunction?this._filterQueryOp==we.Contains?this._filterQueryOp.operator+"("+r+","+i+") eq true":this._filterQueryOp.operator+"("+i+","+r+") eq true":i+" "+this._filterQueryOp.operator+" "+r},o.toFunction=function(e){var n=this._fnNode1.dataType||ce.fromValue(this._value),r=t(e,this._filterQueryOp,n),i=this._fnNode1.fn;if(void 0!==this.fnNode2||this._valueIsLiteral||(this.fnNode2=Ne.create(this._value,e)),this.fnNode2){var a=this.fnNode2.fn;return function(t){return r(i(t),a(t))}}var o=this._value;return function(t){return r(i(t),o)}},o.toString=function(){return D("{%1} %2 {%3}",this._propertyOrExpr,this._filterQueryOp.operator,this._value)},o.validate=function(t){this._fnNode1&&(this._fnNode1.validate(t),this.dataType=this._fnNode1.dataType)},a}(),Ae=function(){function t(t,e,n){var r,i;switch(e){case Oe.Not:return r=n[0].toFunction(t),function(t){return!r(t)};case Oe.And:return i=n.map(function(e){return e.toFunction(t)}),function(t){var e=i.reduce(function(e,n){return e&&n(t)},!0);return e};case Oe.Or:return i=n.map(function(e){return e.toFunction(t)}),function(t){var e=i.reduce(function(e,n){return e||n(t)},!1);return e};default:throw Error("Invalid boolean operator:"+e)}}var e=function(t,e){if(!Array.isArray(e))throw Error("predicates parameter must be an array");if("not"===this.symbol&&1!==e.length)throw Error("Only a single predicate can be passed in with the 'Not' operator");if(this._booleanQueryOp=Oe.from(t),!this._booleanQueryOp)throw Error("Unknown query operation: "+t);this._predicates=e},n=new be({prototype:!0});return e.prototype=n,n.toOdataFragment=function(t){if(1==this._predicates.length)return this._booleanQueryOp.operator+" "+"("+this._predicates[0].toOdataFragment(t)+")";var e=this._predicates.map(function(e){return"("+e.toOdataFragment(t)+")"}).join(" "+this._booleanQueryOp.operator+" ");return e},n.toFunction=function(e){return t(e,this._booleanQueryOp,this._predicates)},n.toString=function(){if(1==this._predicates.length)return this._booleanQueryOp.operator+" "+"("+this._predicates[0]+")";var t=this._predicates.map(function(t){return"("+(""+t)+")"}).join(" "+this._booleanQueryOp.operator+" ");return t},n.validate=function(t){this._isValidated||(this._predicates.every(function(e){e.validate(t)}),this._isValidated=!0)},e}(),xe=function(){var t=function(e,n){return e.prototype===!0?this:t.create(e,n)},e=t.prototype;return t.create=function(t,e){if(t.length>1){var n=t.map(function(t){return new Me(t,e)});return new Ie(n)}return new Me(t[0],e)},t.combine=function(t){return new Ie(t)},t.isOrderByClause=function(t){return t instanceof xe},e.addClause=function(t){return new Ie([this,t])},t}(),Me=function(){var t=function(t,e){if("string"!=typeof t)throw Error("propertyPath is not a string");t=t.trim();var n=t.split(" ");if(n.length>1&&e!==!0&&e!==!1&&(e=I(n[1].toLowerCase(),"desc"),!e)){var r=I(n[1].toLowerCase(),"asc");if(!r)throw Error("the second word in the propertyPath must begin with 'desc' or 'asc'")}this.propertyPath=n[0],this.isDesc=e},e=new xe({prototype:!0});return t.prototype=e,e.validate=function(t){t&&(this.lastProperty=t.getProperty(this.propertyPath,!0))},e.toOdataFragment=function(t){return t._clientPropertyPathToServer(this.propertyPath)+(this.isDesc?" desc":"")},e.getComparer=function(t){if(this.lastProperty||this.validate(t),this.lastProperty)var e=this.lastProperty.dataType,n=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive;var r=this.propertyPath,i=this.isDesc;return function(t,a){var o=L(t,r),s=L(a,r),u=e||o&&ce.fromValue(o)||ce.fromValue(s);if(u===ce.String)n?(o=o||"",s=s||""):(o=(o||"").toLowerCase(),s=(s||"").toLowerCase());else{var p=q(u);o=p(o),s=p(s)}return o==s?0:o>s||void 0===s?i?-1:1:i?1:-1}},t}(),Ie=function(){var t=function(t){var e=[];t.forEach(function(t){if(t instanceof Ie)e=e.concat(t.orderByClauses);else{if(!(t instanceof Me))throw Error("Invalid argument to CompositeOrderByClause ctor.");e.push(t)}}),this._orderByClauses=e},e=new xe({prototype:!0});return t.prototype=e,e.validate=function(t){this._orderByClauses.forEach(function(e){e.validate(t)})},e.toOdataFragment=function(t){var e=this._orderByClauses.map(function(e){return e.toOdataFragment(t)
});return e.join(",")},e.getComparer=function(t){var e=this._orderByClauses.map(function(e){return e.getComparer(t)});return function(t,n){for(var r=0;e.length>r;r++){var i=e[r](t,n);if(0!=i)return i}return 0}},t}(),ke=function(){var t=function(t){this.propertyPaths=t,this._pathNames=t.map(function(t){return t.replace(".","_")})},e=t.prototype;return e.validate=function(t){t&&this.propertyPaths.forEach(function(e){t.getProperty(e,!0)})},e.toOdataFragment=function(t){var e=this.propertyPaths.map(function(e){return t._clientPropertyPathToServer(e)}).join(",");return e},e.toFunction=function(){var t=this;return function(e){var n={};return t.propertyPaths.forEach(function(r,i){n[t._pathNames[i]]=L(e,r)}),n}},t}(),De=function(){var t=function(t){this.propertyPaths=t},e=t.prototype;return e.toOdataFragment=function(t){var e=this.propertyPaths.map(function(e){return t._clientPropertyPathToServer(e)}).join(",");return e},t}();B.FilterQueryOp=we,B.Predicate=be,B.EntityQuery=Se,B.FnNode=Ne,B.OrderByClause=xe;var Fe=function(){var t=new X("MergeStrategy");return t.PreserveChanges=t.addSymbol(),t.OverwriteChanges=t.addSymbol(),t.seal(),t}(),Ve=function(){var t=new X("FetchStrategy");return t.FromServer=t.addSymbol(),t.FromLocalCache=t.addSymbol(),t.seal(),t}(),Ke=function(){function t(t,e){return e&&W(e).whereParam("fetchStrategy").isEnumOf(Ve).isOptional().whereParam("mergeStrategy").isEnumOf(Fe).isOptional().applyAll(t),t}var e=function(e){t(this,e)},n=e.prototype;return n._$typeName="QueryOptions",e.resolve=function(t){return new Ke(c(t,["fetchStrategy","mergeStrategy"]))},e.defaultInstance=new e({fetchStrategy:Ve.FromServer,mergeStrategy:Fe.PreserveChanges}),n.using=function(e){if(!e)return this;var n=new Ke(this);return Fe.contains(e)?e={mergeStrategy:e}:Ve.contains(e)&&(e={fetchStrategy:e}),t(n,e)},n.setAsDefault=function(){return u(this,e)},n.toJSON=function(){return p(this,{fetchStrategy:null,mergeStrategy:null})},e.fromJSON=function(t){return new Ke({fetchStrategy:Ve.fromName(t.fetchStrategy),mergeStrategy:Fe.fromName(t.mergeStrategy)})},e}();B.QueryOptions=Ke,B.FetchStrategy=Ve,B.MergeStrategy=Fe;var je=function(){function t(t){if(t){if(1===t.length){var e=t[0];return function(t){return t?t.entityAspect.entityState===e:!1}}return function(e){return e?t.some(function(t){return e.entityAspect.entityState===t}):!1}}return function(t){return!!t}}var e=t([se.Added,se.Modified,se.Deleted]),n=function(t,e){this.entityManager=t,this.entityType=e,this._indexMap={},this._entities=[],this._emptyIndexes=[]},r=n.prototype;return r.attachEntity=function(t,e){var n,r=t.entityAspect,i=r.getKey()._keyInGroup;if(n=this._indexMap[i],n>=0){if(this._entities[n]===t)return t;throw Error("This key is already attached: "+r.getKey())}return 0===this._emptyIndexes.length?n=this._entities.push(t)-1:(n=this._emptyIndexes.pop(),this._entities[n]=t),this._indexMap[i]=n,r.entityState=e,r.entityGroup=this,r.entityManager=this.entityManager,t},r.detachEntity=function(t){var e=t.entityAspect,n=e.getKey()._keyInGroup,r=this._indexMap[n];if(void 0===r)throw Error("internal error - entity cannot be found in group");return delete this._indexMap[n],this._emptyIndexes.push(r),this._entities[r]=null,t},r.findEntityByKey=function(t){var e;e=t instanceof oe?t._keyInGroup:oe.createKeyString(t);var n=this._indexMap[e];return void 0!==n?this._entities[n]:null},r.hasChanges=function(){return this._entities.some(e)},r.getEntities=function(e){var n=t(e),r=this._entities.filter(n);return r},r._clear=function(){this._entities.forEach(function(t){null!=t&&t.entityAspect._detach()}),this._entities=null,this._indexMap=null,this._emptyIndexes=null},r._fixupKey=function(t,e){var n=this._indexMap[t];if(void 0===n)throw Error("Internal Error in key fixup - unable to locate entity");var r=this._entities[n],i=r.entityType.keyProperties[0].name;r.setProperty(i,e),delete r.entityAspect.hasTempKey,delete this._indexMap[t],this._indexMap[e]=n},r._replaceKey=function(t,e){var n=this._indexMap[t._keyInGroup];delete this._indexMap[t._keyInGroup],this._indexMap[e._keyInGroup]=n},n}(),Re=function(){function e(t,e,n){var r=n?Ke.defaultInstance:t.queryOptions,i=n?Le.defaultInstance:t.saveOptions,a=n?ne.defaultInstance:t.validationOptions,o=W(e).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(ue).whereParam("queryOptions").isInstanceOf(Ke).isOptional().withDefault(r).whereParam("saveOptions").isInstanceOf(Le).isOptional().withDefault(i).whereParam("validationOptions").isInstanceOf(ne).isOptional().withDefault(a).whereParam("keyGeneratorCtor").isFunction().isOptional();n&&(o=o.whereParam("metadataStore").isInstanceOf(le).isOptional().withDefault(new le)),o.applyAll(t),s(t.queryOptions,r),s(t.saveOptions,i),s(t.validationOptions,a),e.serviceName&&(t.dataService=new ue({serviceName:t.serviceName})),t.serviceName=t.dataService&&t.dataService.serviceName,t.keyGeneratorCtor=t.keyGeneratorCtor||Pe,(n||e.keyGeneratorCtor)&&(t.keyGenerator=new t.keyGeneratorCtor)}function n(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;r>n;n++)if(t[n]!==e[n])return!1;return!0}function r(t,e){return z(e,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(he).or().isNonEmptyArray().isInstanceOf(he).check(),"string"==typeof e?e=t.metadataStore._getEntityType(e,!1):Array.isArray(e)&&"string"==typeof e[0]&&(e=e.map(function(e){return t.metadataStore._getEntityType(e,!1)})),e}function o(t,e,n){var r,i=N(t,e);return i.forEach(function(t){if(t){var e=t.getEntities(n);r?r.push.apply(r,e):r=e}}),r||[]}function u(t,e){if(e[0]instanceof oe)return{entityKey:e[0],remainingArgs:G(e,1)};if("string"==typeof e[0]&&e.length>=2){var n=t.metadataStore._getEntityType(e[0],!1);return{entityKey:new oe(n,e[1]),remainingArgs:G(e,2)}}throw Error("This method requires as its initial parameters either an EntityKey or an entityType name followed by a value or an array of values.")}function p(t,e){t.forEach(function(t){t.entityAspect.isBeingSaved=e})}function c(e,n){var r;n?(r={},n.forEach(function(t){var e=r[t.entityType.name];e||(e={},e.entityType=t.entityType,e._entities=[],r[t.entityType.name]=e),e._entities.push(t)})):r=e._entityGroupMap;var i=[],a={};return t(r,function(t,e){a[t]=y(e,i)}),{entityGroupMap:a,tempKeys:i}}function y(t,e){var n={},r=t.entityType,a=r.dataProperties.map(i("name"));n.dataPropertyNames=a;var o=[];return t._entities.forEach(function(t){if(t){var n=[];a.forEach(function(e){n.push(t.getProperty(e))});var r=t.entityAspect,i=r.entityState,s={tempNavPropNames:f(r,e),entityState:i.name};(i.isModified()||i.isDeleted())&&(s.originalValuesMap=r.originalValues),n.push(s),o.push(n)}}),n.entities=o,n}function f(t,e){var n=t.entity;t.hasTempKey&&e.push(t.getKey().toJSON());var r;return n.entityType.navigationProperties.forEach(function(t){if(t.relatedDataProperties){var e=n.getProperty(t.name);e&&e.entityAspect.hasTempKey&&(r=r||[],r.push(t.name))}}),r}function m(t,e,n){var r=n.tempKeyMap,i=t.entityType,a=n.mergeStrategy===Fe.OverwriteChanges,o=null,s=e.dataPropertyNames,u=s.map(function(t){return i.getProperty(t)}),p=i.keyProperties.map(function(t){return s.indexOf(t.name)}),c=s.length,y=t.entityManager.entityChanged;e.entities.forEach(function(e){var n,s=e[c],l=p.map(function(t){return e[t]}),f=new oe(i,l),h=se.fromName(s.entityState);if(h.isAdded()?(n=r[""+f],o=void 0===n?t.findEntityByKey(f):null):o=t.findEntityByKey(f),o){var d=o.entityAspect.entityState.isUnchanged();a||d?(u.forEach(function(t,n){q(o,t,e[n])}),y.publish({entityAction:re.MergeOnImport,entity:o}),d?h.isUnchanged()||t.entityManager._notifyStateChange(o,!0):h.isUnchanged()&&t.entityManager._notifyStateChange(o,!1)):o=null}else o=i._createEntityCore(),u.forEach(function(t,n){q(o,t,e[n])}),void 0!==n&&(o.setProperty(i.keyProperties[0].name,n),s.tempNavPropNames&&s.tempNavPropNames.forEach(function(t){var e=i.getNavigationProperty(t),n=e.relatedDataProperties[0].name,a=o.getProperty(n),s=new oe(e.entityType,[a]),u=r[""+s];o.setProperty(n,u)})),o.entityAspect._postInitialize(),o=t.attachEntity(o,h),y&&(y.publish({entityAction:re.AttachOnImport,entity:o}),h.isUnchanged()||t.entityManager._notifyStateChange(o,!0));o&&(o.entityAspect.entityState=h,h.isModified()&&(o.entityAspect.originalValuesMap=s.originalValues),t.entityManager._linkRelatedEntities(o))})}function g(t,e,n){return t=t.then(function(t){return e&&e(t),ye.resolve(t)}).fail(function(t){return n&&n(t),ye.reject(t)})}function P(t,e){var n;return n=e?e.filter(function(e){if(e.entityAspect.entityManager!==t)throw Error("Only entities in this entityManager may be saved");return!e.entityAspect.entityState.isDetached()}):t.getChanges()}function S(t,e){t._inKeyFixup=!0,e.forEach(function(e){var n=t._entityGroupMap[e.entityTypeName];n._fixupKey(e.tempValue,e.realValue)}),t._inKeyFixup=!1}function N(t,e){function n(){return Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null")}var r=t._entityGroupMap;if(e){if(e instanceof he)return[r[e.name]];if(Array.isArray(e))return e.map(function(t){if(t instanceof he)return r[t.name];throw n()});throw n()}return a(r)}function w(t,e){var n=e.entityAspect.getKey(),r=d(e.entityType.keyProperties,n.values,function(t,e){return t.defaultValue===e?t:null}).filter(function(t){return null!==t});if(r.length)if(e.entityType.autoGeneratedKeyType!==ge.None)t.generateTempKeyValue(e);else if(r.length===n.values.length)throw Error("Cannot attach an object to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'")}function b(t,e){function n(){return Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates")}if(!e)return null;if(se.contains(e))e=[e];else{if(!Array.isArray(e))throw n();e.forEach(function(t){if(!se.contains(t))throw n()})}return e}function C(t,e,n){var r=pe(t,e.entityType);r.attachEntity(e,n),t._linkRelatedEntities(e)}function A(t,e,n){var r=e.entityType.navigationProperties;r.forEach(function(r){var i=e.getProperty(r.name);if(r.isScalar){if(!i)return;t.attachEntity(i,n)}else i.forEach(function(e){t.attachEntity(e,n)})})}function M(t,e,n,r){try{var i=t.metadataStore;if(i.isEmpty()&&r.hasServerMetadata)throw Error("cannot execute _executeQueryCore until metadataStore is populated.");if(n.fetchStrategy===Ve.FromLocalCache)return ye.fcall(function(){var n=t.executeQueryLocally(e);return{results:n,query:e}});var a=r.makeUrl(i.toQueryString(e)),o={url:a,query:e,entityManager:t,dataService:r,queryOptions:n,refMap:{},deferredFns:[]},s=t.validationOptions.validateOnQuery;return r.adapterInstance.executeQuery(o).then(function(n){var i=T(function(){var e={isLoading:t.isLoading};return t.isLoading=!0,t._pendingPubs=[],e},function(n){t.isLoading=n.isLoading,t._pendingPubs.forEach(function(t){t()}),t._pendingPubs=null,e=null,o=null,n.error&&ye.reject(n.error)},function(){var i=r.jsonResultsAdapter.extractResults(n);Array.isArray(i)||(i=[i]);var a=i.map(function(t){var e=I(t,o,{nodeType:"root"});return s&&e.entityAspect&&e.entityAspect.validateEntity(),e});return o.deferredFns.length>0&&o.deferredFns.forEach(function(t){t()}),{results:a,query:e,entityManager:t,XHR:n.XHR,inlineCount:n.inlineCount}});return ye.resolve(i)}).fail(function(t){return t&&(t.query=e),ye.reject(t)})}catch(u){return u&&(u.query=e),ye.reject(u)}}function I(t,e,n){if(null==e.query&&t.entityAspect)return t.entityAspect.entityState.isDeleted()?e.entityManager.detachEntity(t):t.entityAspect.acceptChanges(),t;n=n||{};var r=e.dataService.jsonResultsAdapter.visitNode(t,e,n)||{};return e.query&&"root"===n.nodeType&&!r.entityType&&(r.entityType=e.query._getToEntityType&&e.query._getToEntityType(e.entityManager.metadataStore)),k(t,e,r)}function k(t,e,n,r){if(n.ignore||null==t)return null;if(n.nodeRefId){var i=D(n.nodeRefId,e);return"function"==typeof i?(e.deferredFns.push(function(){r(i)}),void 0):i}return n.entityType?n.entityType.isComplexType?t:F(t,e,n):(n.nodeId&&(e.refMap[n.nodeId]=t),"object"!=typeof t||O(t)?t:V(t,e))}function D(t,e){var n=e.refMap[t];return void 0===n?function(){return e.refMap[t]}:n}function F(t,e,n){t._$meta=n;var r=e.entityManager,i=n.entityType;"string"==typeof i&&(i=r.metadataStore._getEntityType(i,!1)),t.entityType=i;var a=e.queryOptions.mergeStrategy,o=null==e.query,s=j(t,i),u=r.findEntityByKey(s);if(u){if(o&&u.entityAspect.entityState.isDeleted())return r.detachEntity(u),u;var p=u.entityAspect.entityState;if(a===Fe.OverwriteChanges||p.isUnchanged()){K(u,t,e),u.entityAspect.wasLoaded=!0,n.extra&&(u.entityAspect.extraMetadata=n.extra),u.entityAspect.entityState=se.Unchanged,u.entityAspect.originalValues={},u.entityAspect.propertyChanged.publish({entity:u,propertyName:null});var c=o?re.MergeOnSave:re.MergeOnQuery;r.entityChanged.publish({entityAction:c,entity:u}),p.isUnchanged||r._notifyStateChange(u,!1)}else U(e,u,t),i.navigationProperties.forEach(function(n){n.isScalar?$(t,n,e):Z(t,n,e)})}else u=i._createEntityCore(),u.initializeFrom&&u.initializeFrom(t),K(u,t,e),u.entityAspect._postInitialize(),n.extra&&(u.entityAspect.extraMetadata=n.extra),C(r,u,se.Unchanged),u.entityAspect.wasLoaded=!0,r.entityChanged.publish({entityAction:re.AttachOnQuery,entity:u});return u}function V(e,n){var r=n.entityManager,i=n.dataService.jsonResultsAdapter,a=r.metadataStore.namingConvention.serverPropertyNameToClient,o={};return t(e,function(t,e){var r=i.visitNode(e,n,{nodeType:"anonProp",propertyName:t})||{};if(!r.ignore){var s=a(t);o[s]=Array.isArray(e)?e.map(function(e,a){return r=i.visitNode(e,n,{nodeType:"anonPropItem",propertyName:t})||{},k(e,n,r,function(t){o[s][a]=t()})}):k(e,n,r,function(t){o[s]=t()})}}),o}function K(t,e,n){U(n,t,e);var r=t.entityType;r.dataProperties.forEach(function(n){L(t,n,e)}),r.navigationProperties.forEach(function(r){r.isScalar?Q(r,t,e,n):X(r,t,e,n)})}function j(t,e){var n=e.keyProperties.map(function(e){return B(e,R(t,e))});return new oe(e,n)}function R(t,e){return t[e.nameOnServer||e.isUnmapped&&e.name]}function L(t,e,n){var r=R(n,e);q(t,e,r)}function q(t,e,n){if(void 0!==n){var r=B(e,n);e.isComplexProperty?(oldVal=t.getProperty(e.name),e.isScalar?e.dataType.dataProperties.forEach(function(t){L(oldVal,t,r)}):(oldVal.length=0,r.forEach(function(n){var r=e.dataType._createInstanceCore(t,e.name);e.dataType.dataProperties.forEach(function(t){L(r,t,n)}),oldVal.push(r)}))):t.setProperty(e.name,r)}}function B(t,e){return void 0===e?void 0:(t.dataType.isDate&&e?O(e)||(e=ce.parseDateFromServer(e)):t.dataType===ce.Binary&&e&&void 0!==e.$value&&(e=e.$value),e)}function U(t,e,n){var r=n._$meta.nodeId;null!=r&&(t.refMap[r]=e)}function Q(t,e,n,r){var i=$(n,t,r);null!=i&&("function"==typeof i?r.deferredFns.push(function(){i=i(),J(i,e,t)}):J(i,e,t))}function $(t,e,n){var r=t[e.nameOnServer];if(!r)return null;var i=I(r,n,{nodeType:"navProp",navigationProperty:e});return i}function J(t,e,n){if(t){var r=n.name,i=e.getProperty(r);if(i!==t){e.setProperty(r,t);var a=n.inverse;if(!a)return;if(a.isScalar)t.setProperty(a.name,e);else{var o=t.getProperty(a.name);o.push(e)}}}}function X(t,e,n,r){var i=Z(n,t,r);if(null!=i){var a=t.inverse;if(a){var o=e.getProperty(t.name);o.wasLoaded=!0,i.forEach(function(t){"function"==typeof t?r.deferredFns.push(function(){t=t(),te(t,o,e,a)}):te(t,o,e,a)})}}}function Z(t,e,n){var r=t[e.nameOnServer];if(!r)return null;if(!Array.isArray(r))return null;var i=r.map(function(t){return I(t,n,{nodeType:"navPropItem",navigationProperty:e})});return i}function te(t,e,n,r){if(t){var i=t.getProperty(r.name);i!==n&&(e.push(t),t.setProperty(r.name,n))}}function ee(t){var e=t.filter(function(t){return t.entityAspect.isBeingSaved=!0,t.entityAspect.entityState.isModified()&&t.entityType.concurrencyProperties.length>0});0!==e.length&&e.forEach(function(t){t.entityType.concurrencyProperties.forEach(function(e){ae(t,e)})})}function ae(t,e){if(!t.entityAspect.originalValues[e.name]){var n=t.getProperty(e.name);if(n||(n=e.dataType.defaultValue),e.dataType.isNumeric)t.setProperty(e.name,n+1);else if(e.dataType.isDate){for(var r=new Date,i=new Date;r.getTime()===i.getTime();)i=new Date;t.setProperty(e.name,i)}else{if(e.dataType!==ce.Guid){if(e.dataType===ce.Binary)return;throw Error("Unable to update the value of concurrency property before saving: "+e.name)}t.setProperty(e.name,_())}}}function pe(t,e){var n=t._entityGroupMap[e.name];return n||(n=new je(t,e),t._entityGroupMap[e.name]=n),n}function fe(t,e){var n=e.getSelfAndSubtypes();return n.map(function(e){return pe(t,e)})}function de(t,e){var n={},r=t.entityType||t.complexType;return r.dataProperties.forEach(function(r){if(!r.isUnmapped||!e)if(r.isComplexProperty)r.isScalar?n[r.nameOnServer]=de(t.getProperty(r.name),e):(complexObjs=t.getProperty(r.name),n[r.nameOnServer]=complexObjs.map(function(t){return de(t,e)}));else{var i=t.getProperty(r.name);i=Ee(i,r,e),void 0!==i&&(n[r.nameOnServer]=i)}}),n}function me(e,n,r){var i=e.entityType||e.complexType,a=e.entityAspect||e.complexAspect,o=n.namingConvention.clientPropertyNameToServer,s={};return t(a.originalValues,function(t,e){var n=i.getProperty(t);e=Ee(e,n,r),void 0!==e&&(s[o(t,n)]=e)}),i.complexProperties.forEach(function(t){var i=e.getProperty(t.name);if(t.isScalar){var a=me(i,n,r);x(a)||(s[o(t.name,t)]=a)}else{var u=i.map(function(t){return me(t,n,r)});s[o(t.name,t)]=u}}),s}function ve(e,n,r){var i=e.entityType||e.complexType,a=e.entityAspect||e.complexAspect,o=n.namingConvention.clientPropertyNameToServer,s={};return t(a.originalValues,function(t){var n=i.getProperty(t),a=e.getProperty(t);a=Ee(a,n,r),void 0!==a&&(s[o(t,n)]=a)}),i.complexProperties.forEach(function(t){var r=e.getProperty(t.name);if(t.isScalar){var i=ve(r,n);x(i)||(s[o(t.name,t)]=i)}else{var a=r.map(function(t){return ve(t,n)});s[o(t.name,t)]=a}}),s}function Ee(t,e,n){if(n){if(e.isUnmapped)return;e.dataType===ce.DateTimeOffset?t=t&&new Date(t.getTime()-6e4*t.getTimezoneOffset()):e.dataType.quoteJsonOData&&(t=null!=t?""+t:t)}return t}function Te(){this.map={}}var _e=function(t){if(arguments.length>1)throw Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.");0===arguments.length?t={serviceName:""}:"string"==typeof t&&(t={serviceName:t}),e(this,t,!0),this.entityChanged=new H("entityChanged_entityManager",this),this.hasChangesChanged=new H("hasChangesChanged_entityManager",this),this.clear()},Ne=_e.prototype;return Ne._$typeName="EntityManager",H.bubbleEvent(Ne,null),Ne.setProperties=function(t){e(this,t,!1)},Ne.createEntity=function(t,e,n){z(t,"entityType").isString().or().isInstanceOf(he).check(),"string"==typeof t&&(t=this.metadataStore._getEntityType(t)),n=n||se.Added;var r;return E(this,"isLoading",!0,function(){r=t.createEntity(e)}),n!==se.Detached&&this.attachEntity(r,n),r},_e.importEntities=function(t,e){var n=new Re;return n.importEntities(t,e),n},Ne.exportEntities=function(t){var e=c(this,t),n={metadataStore:this.metadataStore.exportMetadata(),dataService:this.dataService,saveOptions:this.saveOptions,queryOptions:this.queryOptions,validationOptions:this.validationOptions,tempKeys:e.tempKeys,entityGroupMap:e.entityGroupMap},r=JSON.stringify(n,null,Y.stringifyPad);return r},Ne.importEntities=function(e,n){n=n||{},W(n).whereParam("mergeStrategy").isEnumOf(Fe).isOptional().withDefault(this.queryOptions.mergeStrategy).applyAll(n);var r=this,i=JSON.parse(e);this.metadataStore.importMetadata(i.metadataStore),this.dataService=i.dataService&&ue.fromJSON(i.dataService)||new ue({serviceName:i.serviceName}),this.saveOptions=new Le(i.saveOptions),this.queryOptions=Ke.fromJSON(i.queryOptions),this.validationOptions=new ne(i.validationOptions);var a={};return i.tempKeys.forEach(function(t){var e=oe.fromJSON(t,r.metadataStore);a[""+e]=r.keyGenerator.generateTempKeyValue(e.entityType,e.values[0])}),n.tempKeyMap=a,T(function(){r._pendingPubs=[]},function(){r._pendingPubs.forEach(function(t){t()}),r._pendingPubs=null},function(){t(i.entityGroupMap,function(t,e){var i=r.metadataStore._getEntityType(t,!0),a=pe(r,i);m(a,e,n)})}),this},Ne.clear=function(){t(this._entityGroupMap,function(t,e){e._clear()}),this._entityGroupMap={},this._unattachedChildrenMap=new Te,this.keyGenerator=new this.keyGeneratorCtor,this.entityChanged.publish({entityAction:re.Clear}),this._hasChanges&&(this._hasChanges=!1,this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}))},Ne.createEmptyCopy=function(){var t=new _e({dataService:this.dataService,metadataStore:this.metadataStore,queryOptions:this.queryOptions,saveOptions:this.saveOptions,validationOptions:this.validationOptions,keyGeneratorCtor:this.keyGeneratorCtor});return t},Ne.addEntity=function(t){return this.attachEntity(t,se.Added)},Ne.attachEntity=function(t,e){if(z(t,"entity").isRequired().check(),this.metadataStore._checkEntityType(t),e=z(e,"entityState").isEnumOf(se).isOptional().check(se.Unchanged),t.entityType.metadataStore!==this.metadataStore)throw Error("Cannot attach this entity because the EntityType and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.");var n=t.entityAspect;n||(n=new ie(t),n._postInitialize(t));var r=n.entityManager;if(r){if(r===this)return t;throw Error("This entity already belongs to another EntityManager")}var i=this;return E(this,"isLoading",!0,function(){e.isAdded()&&w(i,t),C(i,t,e),A(i,t,e)}),this.validationOptions.validateOnAttach&&t.entityAspect.validateEntity(),e.isUnchanged()||this._notifyStateChange(t,!0),this.entityChanged.publish({entityAction:re.Attach,entity:t}),t},Ne.detachEntity=function(t){z(t,"entity").isEntity().check();var e=t.entityAspect;if(!e)return!1;var n=e.entityGroup;if(!n)return!1;if(n.entityManager!==this)throw Error("This entity does not belong to this EntityManager.");return n.detachEntity(t),e._removeFromRelations(),this.entityChanged.publish({entityAction:re.Detach,entity:t}),e._detach(),!0},Ne.fetchMetadata=function(t,e,n){"function"==typeof t?(n=e,e=t,t=null):(z(t,"dataService").isInstanceOf(ue).isOptional().check(),z(e,"callback").isFunction().isOptional().check(),z(n,"errorCallback").isFunction().isOptional().check());var r=this.metadataStore.fetchMetadata(t||this.dataService);return g(r,e,n)},Ne.executeQuery=function(t,e,n){z(t,"query").isInstanceOf(Se).or().isString().check(),z(e,"callback").isFunction().isOptional().check(),z(n,"errorCallback").isFunction().isOptional().check();var r,i=Ke.resolve([t.queryOptions,this.queryOptions,Ke.defaultInstance]),a=ue.resolve([t.dataService,this.dataService]);if(!a.hasServerMetadata||this.metadataStore.hasMetadataFor(a.serviceName))r=M(this,t,i,a);else{var o=this;r=this.fetchMetadata(a).then(function(){return M(o,t,i,a)})}return g(r,e,n)},Ne.executeQueryLocally=function(t){z(t,"query").isInstanceOf(Se).check();var e=this.metadataStore,n=t._getFromEntityType(e,!0),r=fe(this,n),i=t._toFilterFunction(n);if(i)var a=function(t){return t&&!t.entityAspect.entityState.isDeleted()&&i(t)};else var a=function(t){return t&&!t.entityAspect.entityState.isDeleted()};var o=[];r.forEach(function(t){o.push.apply(o,t._entities.filter(a))});var s=t._toOrderByComparer(n);s&&o.sort(s);var u=t.skipCount;u&&(o=o.slice(u));var p=t.takeCount;p&&(o=o.slice(0,p));var c=t.selectClause;if(c){var y=c.toFunction();o=o.map(function(t){return y(t)})}return o},Ne.saveChanges=function(t,e,r,i){z(t,"entities").isOptional().isArray().isEntity().check(),z(e,"saveOptions").isInstanceOf(Le).isOptional().check(),z(r,"callback").isFunction().isOptional().check(),z(i,"errorCallback").isFunction().isOptional().check(),e=e||this.saveOptions||Le.defaultInstance;var a=null==t,o=P(this,t);if(0===o.length){var s={entities:[],keyMappings:[]};return r&&r(s),ye.resolve(s)}if(!e.allowConcurrentSaves){var u=o.some(function(t){return t.entityAspect.isBeingSaved});if(u){var c=Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false");return i&&i(c),ye.reject(c)}}if(this.validationOptions.validateOnSave){var y=o.filter(function(t){var e=t.entityAspect,n=e.entityState.isDeleted()||e.validateEntity();return!n});if(y.length>0){var l=Error("Validation error");return l.entitiesWithErrors=y,i&&i(l),ye.reject(l)}}ee(o);var f=ue.resolve([e.dataService,this.dataService]),h={entityManager:this,dataService:f,resourceName:e.resourceName||this.saveOptions.resourceName||"SaveChanges"},d={mergeStrategy:Fe.OverwriteChanges},m={entities:o,saveOptions:e},v=this;return f.adapterInstance.saveChanges(h,m).then(function(t){S(v,t.keyMappings);var e={query:null,entityManager:v,queryOptions:d,dataService:f,refMap:{},deferredFns:[]},i=t.entities.map(function(t){return I(t,e,{nodeType:"root"})});return p(o,!1),v._hasChanges=a&&n(o,i)?!1:v._hasChangesCore(),v._hasChanges||v.hasChangesChanged.publish({entityManager:v,hasChanges:!1}),t.entities=i,r&&r(t),ye.resolve(t)},function(t){return p(o,!1),i&&i(t),ye.reject(t)})},Ne._findEntityGroup=function(t){return this._entityGroupMap[t.name]},Ne.getEntityByKey=function(){var t,e=u(this,arguments).entityKey,n=e._subTypes;if(!n)return t=this._findEntityGroup(e.entityType),t&&t.findEntityByKey(e);for(var r=0,i=n.length;i>r;r++){t=this._findEntityGroup(n[r]);var a=t&&t.findEntityByKey(e);if(a)return a}},Ne.fetchEntityByKey=function(){var t,e=u(this,arguments),n=e.entityKey,r=0===e.remainingArgs.length?!1:!!e.remainingArgs[0],i=!1;return r&&(t=this.getEntityByKey(n),i=t&&t.entityAspect.entityState.isDeleted(),i&&(t=null,this.queryOptions.mergeStrategy===Fe.OverwriteChanges&&(i=!1))),t||i?ye.resolve({entity:t,entityKey:n,fromCache:!0}):Se.fromEntityKey(n).using(this).execute().then(function(e){return t=0===e.results.length?null:e.results[0],ye.resolve({entity:t,entityKey:n,fromCache:!1})})},Ne.findEntityByKey=function(t){return this.getEntityByKey(t)},Ne.generateTempKeyValue=function(t){z(t,"entity").isEntity().check();var e=t.entityType,n=this.keyGenerator.generateTempKeyValue(e),r=e.keyProperties[0];return t.setProperty(r.name,n),t.entityAspect.hasTempKey=!0,n},Ne.hasChanges=function(t){return this._hasChanges?void 0===t?this._hasChanges:this._hasChangesCore(t):!1},Ne._hasChangesCore=function(t){t=r(this,t);var e=N(this,t);return e.some(function(t){return t.hasChanges()})},Ne.getChanges=function(t){t=r(this,t);var e=[se.Added,se.Modified,se.Deleted];return o(this,t,e)},Ne.rejectChanges=function(){if(!this._hasChanges)return[];var t=[se.Added,se.Modified,se.Deleted],e=o(this,null,t);return this._hasChanges=!1,e.forEach(function(t){t.entityAspect.rejectChanges()}),this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}),e},Ne.getEntities=function(t,e){return t=r(this,t),z(e,"entityStates").isOptional().isEnumOf(se).or().isNonEmptyArray().isEnumOf(se).check(),e&&(e=b(this,e)),o(this,t,e)},Ne._notifyStateChange=function(t,e){this.entityChanged.publish({entityAction:re.EntityStateChange,entity:t}),e?this._hasChanges||(this._hasChanges=!0,this.hasChangesChanged.publish({entityManager:this,hasChanges:!0})):this._hasChanges&&(this._hasChanges=this._hasChangesCore(),this._hasChanges||this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}))},Ne._linkRelatedEntities=function(t){var e=this,n=t.entityAspect;E(e,"isLoading",!0,function(){var r=e._unattachedChildrenMap,i=n.getKey(),a=r.getTuples(i);a&&a.forEach(function(e){var n=e.navigationProperty,a=n.inverse,o=e.children.filter(function(t){return t.entityAspect.entityState!==se.Detached});if(a)if(a.isScalar){var s=o[0];t.setProperty(a.name,s),s.setProperty(n.name,t)}else{var u=t.getProperty(a.name);o.forEach(function(e){u.push(e),e.setProperty(n.name,t)})}else o.forEach(function(e){e.setProperty(n.name,t)});r.removeChildren(i,n)}),t.entityType.navigationProperties.forEach(function(i){if(i.isScalar){var a=t.getProperty(i.name);if(a)return}var o=n.getParentKey(i);if(o){if(o._isEmpty())return;var s=e.findEntityByKey(o);s?t.setProperty(i.name,s):r.addChild(o,i,t)}})})},Ne.helper={unwrapInstance:de,unwrapOriginalValues:me,unwrapChangedValues:ve,getEntityKeyFromRawEntity:j},Te.prototype.addChild=function(t,e,n){var r=this.getTuple(t,e);r||(r={navigationProperty:e,children:[]},v(this.map,""+t).push(r)),r.children.push(n)},Te.prototype.removeChildren=function(t,e){var n=this.map[""+t];n&&(h(n,function(t){return t.navigationProperty===e}),n.length||delete this.map[""+t])},Te.prototype.getChildren=function(t,e){var n=this.getTuple(t,e);return n?n.children.filter(function(t){return!t.entityAspect.entityState.isDetached()}):null},Te.prototype.getTuple=function(t,e){var n=this.map[""+t];if(!n)return null;var r=l(n,function(t){return t.navigationProperty===e});return r},Te.prototype.getTuples=function(t){return this.map[""+t]},_e}();B.EntityManager=Re;var Le=function(){function t(t,e){return e&&W(e).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(ue).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(t),t}var e=function(e){t(this,e)},n=e.prototype;return n._$typeName="SaveOptions",n.setAsDefault=function(){return u(this,e)},n.using=function(e){return t(this,e)},e.defaultInstance=new e({allowConcurrentSaves:!1}),e}();B.SaveOptions=Le,B.AbstractDataServiceAdapter=function(){var t,e=function(){};return e.prototype.checkForRecomposition=function(t){"ajax"===t.interfaceName&&t.isDefault&&this.initialize()},e.prototype.initialize=function(){if(t=B.config.getAdapterInstance("ajax"),!t)throw Error("Unable to initialize ajax for WebApi.");var e=t.ajax;if(!e)throw Error("Breeze was unable to find an 'ajax' adapter")},e.prototype.fetchMetadata=function(e,n){var r=n.serviceName,i=n.makeUrl("Metadata"),a=ye.defer(),o=this;return t.ajax({url:i,dataType:"json",success:function(t,o,s){var u;if(e.hasMetadataFor(r))return a.resolve("already fetched");var p="string"==typeof t?JSON.parse(t):t;if(p)try{e.importMetadata(p)}catch(c){u=Error("Metadata import failed for "+i+"; Unable to process returned metadata:"+c.message)}else u=Error("Metadata query failed for: "+i);return u?a.reject(u):(e.hasMetadataFor(r)||e.addDataService(n),s.onreadystatechange=null,s.abort=null,a.resolve(p),void 0)},error:function(t){o._handleXHRError(a,t,"Metadata query failed for: "+i)}}),a.promise},e.prototype.executeQuery=function(e){var n=ye.defer(),r=this,i={url:e.url,dataType:"json",success:function(t,e,i){try{var a;a=t.Results?{results:t.Results,inlineCount:t.InlineCount,XHR:i}:{results:t,XHR:i},n.resolve(a),i.onreadystatechange=null,i.abort=null}catch(o){var s=o instanceof Error?o:r._createError(i);n.reject(s),i.onreadystatechange=null,i.abort=null}},error:function(t){r._handleXHRError(n,t)}};return e.dataService.useJsonp&&(i.dataType="jsonp",i.crossDomain=!0),t.ajax(i),n.promise},e.prototype.saveChanges=function(e,n){var r=ye.defer(),n=this._prepareSaveBundle(n,e),i=JSON.stringify(n),a=e.dataService.makeUrl(e.resourceName),o=this;return t.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:i,success:function(t,n,i){var a=t.Error||t.error;if(a){var s=o._createError(i);s.message=a,r.reject(s)}else{var u=o._prepareSaveResult(e,t);r.resolve(u)}},error:function(t){o._handleXHRError(r,t)}}),r.promise},e.prototype._prepareSaveBundle=function(){throw Error("Need a concrete implementation of _prepareSaveBundle")},e.prototype._prepareSaveResult=function(){throw Error("Need a concrete implementation of _prepareSaveResult")},e.prototype.jsonResultsAdapter=new pe({name:"noop",visitNode:function(){return{}}}),e.prototype._handleXHRError=function(t,e,n){var r=this._createError(e);n&&(r.message=n+"; "+r.message),t.reject(r),e.onreadystatechange=null,e.abort=null},e.prototype._createError=function(t){var e=Error();if(e.XHR=t,e.responseText=t.responseText,e.status=t.status,e.statusText=t.statusText,e.message=t.statusText,e.responseText)try{var n=JSON.parse(t.responseText);e.detail=n;var r=n.InnerException||n;e.message=r.ExceptionMessage||r.Message||t.responseText
}catch(i){e.message=e.message+": "+e.responseText}return e},e}(),B.config.initializeAdapterInstances({ajax:"jQuery",dataService:"webApi"});var qe=window.ko;return!qe&&window.require&&(qe=window.require("ko")),qe?B.config.initializeAdapterInstance("modelLibrary","ko"):B.config.initializeAdapterInstance("modelLibrary","backingStore"),this.window.breeze=B,B});